<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>adapt-authoring-contentplugin/lib/ContentPluginModule.js - Adapt authoring tool UI documentation</title>
    
    <meta name="description" content="Adapt authoring tool UI documentation" />
    
        <meta name="keywords" content="v1.0.0-rc.4" />
        <meta name="keyword" content="v1.0.0-rc.4" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a class="menu-title" ><img class="logo" src="assets/logo-outline-colour.png" />Adapt authoring tool back-end API documentation<br><span class="version">v1.0.0-rc.4</span></a></h2><h2><a href="https://adapt-security.github.io/adapt-authoring-documentation/" target="_self" class="menu-item" id="home_link" >Documentation home</a></h2><h2><a href="https://www.adaptlearning.org/" target="_blank" class="menu-item" id="website_link" >Project Website</a></h2><h2><a href="https://community.adaptlearning.org/mod/forum/view.php?id=4" target="_blank" class="menu-item" id="forum_link" >Technical Discussion Forum</a></h2><h3>Namespaces</h3><ul><li><a href="adaptframework.html">adaptframework</a></li><li><a href="assets.html">assets</a></li><li><a href="auth.html">auth</a></li><li><a href="authored.html">authored</a></li><li><a href="browserslist.html">browserslist</a></li><li><a href="config.html">config</a></li><li><a href="content.html">content</a></li><li><a href="contentplugin.html">contentplugin</a></li><li><a href="core.html">core</a></li><li><a href="courseassets.html">courseassets</a></li><li><a href="coursetheme.html">coursetheme</a></li><li><a href="defaultplugins.html">defaultplugins</a></li><li><a href="errors.html">errors</a></li><li><a href="jsonschema.html">jsonschema</a></li><li><a href="lang.html">lang</a></li><li><a href="localauth.html">localauth</a></li><li><a href="logger.html">logger</a></li><li><a href="mailer.html">mailer</a></li><li><a href="middleware.html">middleware</a></li><li><a href="mongodb.html">mongodb</a></li><li><a href="mongodblogger.html">mongodblogger</a></li><li><a href="roles.html">roles</a></li><li><a href="server.html">server</a></li><li><a href="sessions.html">sessions</a></li><li><a href="spoortracking.html">spoortracking</a></li><li><a href="tags.html">tags</a></li><li><a href="users.html">users</a></li></ul><h3>Classes</h3><ul><li><a href="AdaptFrameworkBuildOptions.html">AdaptFrameworkBuildOptions</a></li><li><a href="AdaptFrameworkImportOptions.html">AdaptFrameworkImportOptions</a></li><li><a href="UiModule.html">UiModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="UiModule.html#addUiPlugin">addUiPlugin</a></li><li data-type='method' style='display: none;'><a href="UiModule.html#build">build</a></li><li data-type='method' style='display: none;'><a href="UiModule.html#buildHandler">buildHandler</a></li><li data-type='method' style='display: none;'><a href="UiModule.html#getRebuildStatus">getRebuildStatus</a></li><li data-type='method' style='display: none;'><a href="UiModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="UiModule.html#servePage">servePage</a></li></ul></li><li><a href="adaptframework.AdaptFrameworkBuild.html">AdaptFrameworkBuild</a><ul class='methods'><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#build">build</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#cachePluginData">cachePluginData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#copyAssets">copyAssets</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#copySource">copySource</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#createIdMap">createIdMap</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#createPreview">createPreview</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#createZip">createZip</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#ensureDir">ensureDir</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#loadAssetData">loadAssetData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#loadCourseData">loadCourseData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#recordBuildAttempt">recordBuildAttempt</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#removeOldBuilds">removeOldBuilds</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#sortContentItems">sortContentItems</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#transformContentItems">transformContentItems</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#writeContentJson">writeContentJson</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#.getBuildExpiry">getBuildExpiry</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#.run">run</a></li></ul></li><li><a href="adaptframework.AdaptFrameworkImport.html">AdaptFrameworkImport</a><ul class='methods'><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#cleanUp">cleanUp</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#convertSchemas">convertSchemas</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#extractAssets">extractAssets</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#getSortedData">getSortedData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#import">import</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#importContentObject">importContentObject</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#importCourseAssets">importCourseAssets</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#importCourseData">importCourseData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#importCoursePlugins">importCoursePlugins</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#importTags">importTags</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#loadAssetData">loadAssetData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#loadContentFile">loadContentFile</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#loadCourseData">loadCourseData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#loadPluginData">loadPluginData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#migrateCourseData">migrateCourseData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#patchCustomStyle">patchCustomStyle</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#patchThemeName">patchThemeName</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#prepare">prepare</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#runGruntTask">runGruntTask</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#transformData">transformData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#.run">run</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#.typeToSchema">typeToSchema</a></li></ul></li><li><a href="adaptframework.AdaptFrameworkModule.html">AdaptFrameworkModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#buildCourse">buildCourse</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#checkContentAccess">checkContentAccess</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#getInstalledPlugins">getInstalledPlugins</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#getLatestVersion">getLatestVersion</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#getManifestPlugins">getManifestPlugins</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#importCourse">importCourse</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#initRoutes">initRoutes</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#installFramework">installFramework</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#installFrameworkModules">installFrameworkModules</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#loadSchemas">loadSchemas</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#logStatus">logStatus</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#updateFramework">updateFramework</a></li></ul></li><li><a href="adaptframework.AdaptFrameworkUtils.html">AdaptFrameworkUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.getHandler">getHandler</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.getImportContentCounts">getImportContentCounts</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.getPluginUpdateStatus">getPluginUpdateStatus</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.getUpdateHandler">getUpdateHandler</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.handleImportFile">handleImportFile</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.importHandler">importHandler</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.inferBuildAction">inferBuildAction</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.log">log</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.postHandler">postHandler</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.postUpdateHandler">postUpdateHandler</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.retrieveBuildData">retrieveBuildData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.runCliCommand">runCliCommand</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.slugifyTitle">slugifyTitle</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.toBoolean">toBoolean</a></li></ul></li><li><a href="api.AbstractApiModule.html">AbstractApiModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#addRoute">addRoute</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#addRoutes">addRoutes</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#checkAccess">checkAccess</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#deleteMany">deleteMany</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#find">find</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#getSchema">getSchema</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#getSchemaName">getSchemaName</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#mapStatusCode">mapStatusCode</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#parseQuery">parseQuery</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#processRequestMiddleware">processRequestMiddleware</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#queryHandler">queryHandler</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#requestHandler">requestHandler</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#sanitise">sanitise</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#sanitiseRequestDataMiddleware">sanitiseRequestDataMiddleware</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#serveSchema">serveSchema</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#setDefaultOptions">setDefaultOptions</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#setUpPagination">setUpPagination</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#update">update</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#useDefaultRouteConfig">useDefaultRouteConfig</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#validate">validate</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#validateValues">validateValues</a></li></ul></li><li><a href="api.AbstractApiUtils.html">AbstractApiUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.AbstractApiUtils.html#.argsFromReq">argsFromReq</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiUtils.html#.generateApiMetadata">generateApiMetadata</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiUtils.html#.httpMethodToAction">httpMethodToAction</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiUtils.html#.httpMethodToDBFunction">httpMethodToDBFunction</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiUtils.html#.stringifyValues">stringifyValues</a></li></ul></li><li><a href="api.DataCache.html">DataCache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.DataCache.html#get">get</a></li><li data-type='method' style='display: none;'><a href="api.DataCache.html#prune">prune</a></li></ul></li><li><a href="assets.AbstractAsset.html">AbstractAsset</a><ul class='members'><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#assetRoot">assetRoot</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#ffmpeg">ffmpeg</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#ffprobe">ffprobe</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#hasThumb">hasThumb</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#isAudio">isAudio</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#isImage">isImage</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#isVideo">isVideo</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#path">path</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#thumb">thumb</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#.name">name</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#ensureDir">ensureDir</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#ensureExists">ensureExists</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#generateThumb">generateThumb</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#getFileExtension">getFileExtension</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#move">move</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#read">read</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#resolvePath">resolvePath</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#updateFile">updateFile</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#write">write</a></li></ul></li><li><a href="assets.Assetsmodule.html">Assetsmodule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#createFsWrapper">createFsWrapper</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#deleteMany">deleteMany</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#onRequest">onRequest</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#performHousekeeping">performHousekeeping</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#registerAssetType">registerAssetType</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#serveAssetHandler">serveAssetHandler</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#update">update</a></li></ul></li><li><a href="assets.LocalAsset.html">LocalAsset</a><ul class='members'><li data-type='member' style='display: none;'><a href="assets.LocalAsset.html#assetRoot">assetRoot</a></li><li data-type='member' style='display: none;'><a href="assets.LocalAsset.html#dirname">dirname</a></li><li data-type='member' style='display: none;'><a href="assets.LocalAsset.html#filename">filename</a></li><li data-type='member' style='display: none;'><a href="assets.LocalAsset.html#.name">name</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#ensureDir">ensureDir</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#ensureExists">ensureExists</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#generateMetadata">generateMetadata</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#move">move</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#read">read</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#resolvePath">resolvePath</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#write">write</a></li></ul></li><li><a href="auth.AbstractAuthModule.html">AbstractAuthModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#authenticate">authenticate</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#authenticateHandler">authenticateHandler</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#disavowUser">disavowUser</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#enableHandler">enableHandler</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#register">register</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#registerHandler">registerHandler</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#secureRoute">secureRoute</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#setUserEnabled">setUserEnabled</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#unsecureRoute">unsecureRoute</a></li></ul></li><li><a href="auth.AuthModule.html">AuthModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#apiMiddleware">apiMiddleware</a></li><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#initAuthData">initAuthData</a></li><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#rootMiddleware">rootMiddleware</a></li><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#secureRoute">secureRoute</a></li><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#unsecureRoute">unsecureRoute</a></li></ul></li><li><a href="auth.AuthToken.html">AuthToken</a><ul class='members'><li data-type='member' style='display: none;'><a href="auth.AuthToken.html#.secret">secret</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.decode">decode</a></li><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.find">find</a></li><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.generate">generate</a></li><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.initRequestData">initRequestData</a></li><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.isSuper">isSuper</a></li><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.revoke">revoke</a></li></ul></li><li><a href="auth.AuthUtils.html">AuthUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.AuthUtils.html#.createEmptyStore">createEmptyStore</a></li><li data-type='method' style='display: none;'><a href="auth.AuthUtils.html#.getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="auth.AuthUtils.html#.initAuthData">initAuthData</a></li><li data-type='method' style='display: none;'><a href="auth.AuthUtils.html#.log">log</a></li></ul></li><li><a href="auth.Authentication.html">Authentication</a><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.Authentication.html#checkHandler">checkHandler</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#disavowHandler">disavowHandler</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#disavowUser">disavowUser</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#generateTokenHandler">generateTokenHandler</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#init">init</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#registerPlugin">registerPlugin</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#registerUser">registerUser</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#retrieveTokensHandler">retrieveTokensHandler</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#.init">init</a></li></ul></li><li><a href="auth.Permissions.html">Permissions</a><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.Permissions.html#check">check</a></li><li data-type='method' style='display: none;'><a href="auth.Permissions.html#checkRoutes">checkRoutes</a></li><li data-type='method' style='display: none;'><a href="auth.Permissions.html#getScopesForRoute">getScopesForRoute</a></li><li data-type='method' style='display: none;'><a href="auth.Permissions.html#secureRoute">secureRoute</a></li><li data-type='method' style='display: none;'><a href="auth.Permissions.html#.init">init</a></li></ul></li><li><a href="authored.AuthoredModule.html">AuthoredModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="authored.AuthoredModule.html#checkAccess">checkAccess</a></li><li data-type='method' style='display: none;'><a href="authored.AuthoredModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="authored.AuthoredModule.html#registerModule">registerModule</a></li><li data-type='method' style='display: none;'><a href="authored.AuthoredModule.html#updateAuthor">updateAuthor</a></li><li data-type='method' style='display: none;'><a href="authored.AuthoredModule.html#updateTimestamps">updateTimestamps</a></li></ul></li><li><a href="browserslist.BrowserslistModule.html">BrowserslistModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="browserslist.BrowserslistModule.html#init">init</a></li></ul></li><li><a href="config.ConfigModule.html">ConfigModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#envVarToConfigKey">envVarToConfigKey</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#get">get</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#getPublicConfig">getPublicConfig</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#has">has</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#initRouter">initRouter</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#processModuleSchema">processModuleSchema</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#set">set</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#storeEnvSettings">storeEnvSettings</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#storeSchemaSettings">storeSchemaSettings</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#storeUserSettings">storeUserSettings</a></li></ul></li><li><a href="content.ContentModule.html">ContentModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="content.ContentModule.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#getDescendants">getDescendants</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#getSchema">getSchema</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#getSchemaName">getSchemaName</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#handleClone">handleClone</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#handleInsertRecursive">handleInsertRecursive</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#insertRecursive">insertRecursive</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#update">update</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#updateEnabledPlugins">updateEnabledPlugins</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#updateSortOrder">updateSortOrder</a></li></ul></li><li><a href="contentplugin.ContentPluginModule.html">ContentPluginModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#find">find</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#getMissingPlugins">getMissingPlugins</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#getPluginSchemas">getPluginSchemas</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#getPluginUses">getPluginUses</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#initPlugins">initPlugins</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#insertOrUpdate">insertOrUpdate</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#installHandler">installHandler</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#installPlugin">installPlugin</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#installPlugins">installPlugins</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#isPluginSchema">isPluginSchema</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#processPluginFiles">processPluginFiles</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#processPluginSchemas">processPluginSchemas</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#serveSchema">serveSchema</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#syncPluginData">syncPluginData</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#updateHandler">updateHandler</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#updatePlugin">updatePlugin</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#usesHandler">usesHandler</a></li></ul></li><li><a href="core.AbstractModule.html">AbstractModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="core.AbstractModule.html#getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="core.AbstractModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="core.AbstractModule.html#log">log</a></li><li data-type='method' style='display: none;'><a href="core.AbstractModule.html#onReady">onReady</a></li><li data-type='method' style='display: none;'><a href="core.AbstractModule.html#setReady">setReady</a></li></ul></li><li><a href="core.App.html">App</a><ul class='members'><li data-type='member' style='display: none;'><a href="core.App.html#app">app</a></li><li data-type='member' style='display: none;'><a href="core.App.html#args">args</a></li><li data-type='member' style='display: none;'><a href="core.App.html#dependencies">dependencies</a></li><li data-type='member' style='display: none;'><a href="core.App.html#dependencyloader">dependencyloader</a></li><li data-type='member' style='display: none;'><a href="core.App.html#.instance">instance</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="core.App.html#getGitInfo">getGitInfo</a></li><li data-type='method' style='display: none;'><a href="core.App.html#init">init</a></li><li data-type='method' style='display: none;'><a href="core.App.html#setReady">setReady</a></li><li data-type='method' style='display: none;'><a href="core.App.html#start">start</a></li><li data-type='method' style='display: none;'><a href="core.App.html#waitForModule">waitForModule</a></li></ul></li><li><a href="core.DependencyLoader.html">DependencyLoader</a><ul class='methods'><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#load">load</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#loadConfigs">loadConfigs</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#loadModule">loadModule</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#loadModuleConfig">loadModuleConfig</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#loadModules">loadModules</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#logError">logError</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#waitForModule">waitForModule</a></li></ul></li><li><a href="core.Hook.html">Hook</a><ul class='members'><li data-type='member' style='display: none;'><a href="core.Hook.html#hasObservers">hasObservers</a></li><li data-type='member' style='display: none;'><a href="core.Hook.html#.Types">Types</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="core.Hook.html#invoke">invoke</a></li><li data-type='method' style='display: none;'><a href="core.Hook.html#onInvoke">onInvoke</a></li><li data-type='method' style='display: none;'><a href="core.Hook.html#tap">tap</a></li><li data-type='method' style='display: none;'><a href="core.Hook.html#untap">untap</a></li></ul></li><li><a href="core.Utils.html">Utils</a><ul class='members'><li data-type='member' style='display: none;'><a href="core.Utils.html#.metadataFileName">metadataFileName</a></li><li data-type='member' style='display: none;'><a href="core.Utils.html#.packageFileName">packageFileName</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="core.Utils.html#.getArgs">getArgs</a></li><li data-type='method' style='display: none;'><a href="core.Utils.html#.isObject">isObject</a></li></ul></li><li><a href="courseassets.CourseAssetsModule.html">CourseAssetsModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="courseassets.CourseAssetsModule.html#extractAssetIds">extractAssetIds</a></li><li data-type='method' style='display: none;'><a href="courseassets.CourseAssetsModule.html#handleContentEvent">handleContentEvent</a></li><li data-type='method' style='display: none;'><a href="courseassets.CourseAssetsModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="courseassets.CourseAssetsModule.html#setValues">setValues</a></li></ul></li><li><a href="coursetheme.CourseThemeModule.html">CourseThemeModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#applyHandler">applyHandler</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#getVariablesString">getVariablesString</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#processFileVariables">processFileVariables</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#removeHandler">removeHandler</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#writeCustomLess">writeCustomLess</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#writeFile">writeFile</a></li></ul></li><li><a href="defaultplugins.DefaultPluginsModule.html">DefaultPluginsModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="defaultplugins.DefaultPluginsModule.html#init">init</a></li></ul></li><li><a href="errors.AdaptError.html">AdaptError</a><ul class='methods'><li data-type='method' style='display: none;'><a href="errors.AdaptError.html#setData">setData</a></li><li data-type='method' style='display: none;'><a href="errors.AdaptError.html#toString">toString</a></li></ul></li><li><a href="errors.ErrorModule.html">ErrorModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="errors.ErrorModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="errors.ErrorModule.html#loadErrors">loadErrors</a></li></ul></li><li><a href="jsonschema.JsonSchema.html">JsonSchema</a><ul class='methods'><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#addExtension">addExtension</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#build">build</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#getObjectDefaults">getObjectDefaults</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#getParent">getParent</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#isBuildValid">isBuildValid</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#load">load</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#patch">patch</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#sanitise">sanitise</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#validate">validate</a></li></ul></li><li><a href="jsonschema.JsonSchemaModule.html">JsonSchemaModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#addKeyword">addKeyword</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#addStringFormats">addStringFormats</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#createSchema">createSchema</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#deregisterSchema">deregisterSchema</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#extendSchema">extendSchema</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#getSchema">getSchema</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#registerSchema">registerSchema</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#registerSchemas">registerSchemas</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#resetSchemaRegistry">resetSchemaRegistry</a></li></ul></li><li><a href="jsonschema.Keywords.html">Keywords</a></li><li><a href="lang.LangModule.html">LangModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="lang.LangModule.html#addTranslationUtils">addTranslationUtils</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#getPhrasesForLang">getPhrasesForLang</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#loadPhrases">loadPhrases</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#loadPhrasesForDir">loadPhrasesForDir</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#loadRoutes">loadRoutes</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#requestHandler">requestHandler</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#translate">translate</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#translateError">translateError</a></li></ul></li><li><a href="localauth.LocalAuthModule.html">LocalAuthModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#authenticate">authenticate</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#changePasswordHandler">changePasswordHandler</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#createPasswordReset">createPasswordReset</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#forgotPasswordHandler">forgotPasswordHandler</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#handleLockStatus">handleLockStatus</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#inviteHandler">inviteHandler</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#register">register</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#registerSuper">registerSuper</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#registerSuperHandler">registerSuperHandler</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#setUserEnabled">setUserEnabled</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#updateUser">updateUser</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#validatePasswordHandler">validatePasswordHandler</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#.formatRemainingTime">formatRemainingTime</a></li></ul></li><li><a href="localauth.PasswordUtils.html">PasswordUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.compare">compare</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.createReset">createReset</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.deleteReset">deleteReset</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.generate">generate</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.getRandomHex">getRandomHex</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.validate">validate</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.validateReset">validateReset</a></li></ul></li><li><a href="logger.LoggerModule.html">LoggerModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#getModuleOverrides">getModuleOverrides</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#isLevelEnabled">isLevelEnabled</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#isLoggingEnabled">isLoggingEnabled</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#log">log</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#.colourise">colourise</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#.getDateStamp">getDateStamp</a></li></ul></li><li><a href="mailer.AbstractMailTransport.html">AbstractMailTransport</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mailer.AbstractMailTransport.html#getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="mailer.AbstractMailTransport.html#send">send</a></li><li data-type='method' style='display: none;'><a href="mailer.AbstractMailTransport.html#test">test</a></li></ul></li><li><a href="mailer.FilesystemTransport.html">FilesystemTransport</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mailer.FilesystemTransport.html#send">send</a></li><li data-type='method' style='display: none;'><a href="mailer.FilesystemTransport.html#test">test</a></li></ul></li><li><a href="mailer.MailerModule.html">MailerModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mailer.MailerModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="mailer.MailerModule.html#send">send</a></li><li data-type='method' style='display: none;'><a href="mailer.MailerModule.html#testEmailHandler">testEmailHandler</a></li></ul></li><li><a href="mailer.SmtpTransport.html">SmtpTransport</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mailer.SmtpTransport.html#send">send</a></li><li data-type='method' style='display: none;'><a href="mailer.SmtpTransport.html#test">test</a></li></ul></li><li><a href="middleware.MiddlewareModule.html">MiddlewareModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#bodyParserJson">bodyParserJson</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#bodyParserUrlEncoded">bodyParserUrlEncoded</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#fileUploadParser">fileUploadParser</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#rateLimiter">rateLimiter</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#setDefaultFileOptions">setDefaultFileOptions</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#urlUploadParser">urlUploadParser</a></li></ul></li><li><a href="module.exports.html">exports</a></li><li><a href="mongodb.MongoDBModule.html">MongoDBModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#deleteMany">deleteMany</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#find">find</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#getCollection">getCollection</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#getError">getError</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#getStats">getStats</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#parseOptions">parseOptions</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#replace">replace</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#setIndex">setIndex</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#update">update</a></li></ul></li><li><a href="mongodb.ObjectIdUtils.html">ObjectIdUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mongodb.ObjectIdUtils.html#.addSchemaKeyword">addSchemaKeyword</a></li><li data-type='method' style='display: none;'><a href="mongodb.ObjectIdUtils.html#.create">create</a></li><li data-type='method' style='display: none;'><a href="mongodb.ObjectIdUtils.html#.isValid">isValid</a></li><li data-type='method' style='display: none;'><a href="mongodb.ObjectIdUtils.html#.parse">parse</a></li><li data-type='method' style='display: none;'><a href="mongodb.ObjectIdUtils.html#.parseIds">parseIds</a></li></ul></li><li><a href="mongodblogger.MongoDBLoggerModule.html">MongoDBLoggerModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mongodblogger.MongoDBLoggerModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="mongodblogger.MongoDBLoggerModule.html#logToDb">logToDb</a></li><li data-type='method' style='display: none;'><a href="mongodblogger.MongoDBLoggerModule.html#setValues">setValues</a></li></ul></li><li><a href="roles.RolesModule.html">RolesModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#getScopesForRole">getScopesForRole</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#initConfigRoles">initConfigRoles</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#initDefaultRoles">initDefaultRoles</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#onUpdateRoles">onUpdateRoles</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#shortNamesToIds">shortNamesToIds</a></li></ul></li><li><a href="server.Router.html">Router</a><ul class='methods'><li data-type='method' style='display: none;'><a href="server.Router.html#addHandlerMiddleware">addHandlerMiddleware</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#addMiddleware">addMiddleware</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#addRoute">addRoute</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#createChildRouter">createChildRouter</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#flattenRouters">flattenRouters</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#getHandlerMiddleware">getHandlerMiddleware</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#init">init</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#log">log</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#validateRoute">validateRoute</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#warnOnInited">warnOnInited</a></li></ul></li><li><a href="server.ServerModule.html">ServerModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="server.ServerModule.html#close">close</a></li><li data-type='method' style='display: none;'><a href="server.ServerModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="server.ServerModule.html#listen">listen</a></li><li data-type='method' style='display: none;'><a href="server.ServerModule.html#start">start</a></li><li data-type='method' style='display: none;'><a href="server.ServerModule.html#static">static</a></li></ul></li><li><a href="server.ServerUtils.html">ServerUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.addErrorHandler">addErrorHandler</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.addExistenceProps">addExistenceProps</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.apiNotFoundHandler">apiNotFoundHandler</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.cacheRouteConfig">cacheRouteConfig</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.debugRequestTime">debugRequestTime</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.generateRouterMap">generateRouterMap</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.genericErrorHandler">genericErrorHandler</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.handleInternalRoutes">handleInternalRoutes</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.mapHandler">mapHandler</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.rootNotFoundHandler">rootNotFoundHandler</a></li></ul></li><li><a href="sessions.SessionsModule.html">SessionsModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="sessions.SessionsModule.html#clearSession">clearSession</a></li><li data-type='method' style='display: none;'><a href="sessions.SessionsModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="sessions.SessionsModule.html#storeAuthHeader">storeAuthHeader</a></li></ul></li><li><a href="spoortracking.SpoorTrackingModule.html">SpoorTrackingModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="spoortracking.SpoorTrackingModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="spoortracking.SpoorTrackingModule.html#insertTrackingId">insertTrackingId</a></li><li data-type='method' style='display: none;'><a href="spoortracking.SpoorTrackingModule.html#resetCourseTrackingIds">resetCourseTrackingIds</a></li><li data-type='method' style='display: none;'><a href="spoortracking.SpoorTrackingModule.html#resetTrackingHandler">resetTrackingHandler</a></li></ul></li><li><a href="tags.TagsModule.html">TagsModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#autocompleteHandler">autocompleteHandler</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#registerModule">registerModule</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#setValues">setValues</a></li></ul></li><li><a href="ui.UiBuild.html">UiBuild</a><ul class='members'><li data-type='member' style='display: none;'><a href="ui.UiBuild.html#.BUILD_STATUS">BUILD_STATUS</a></li><li data-type='member' style='display: none;'><a href="ui.UiBuild.html#.rebuildFilePath">rebuildFilePath</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#bundleRequireImports">bundleRequireImports</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#compileHandlebars">compileHandlebars</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#compileLess">compileLess</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#copyAssets">copyAssets</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#copyHbs">copyHbs</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#copyPlugins">copyPlugins</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#copySource">copySource</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#fs">fs</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#getFiles">getFiles</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#initBuildFolder">initBuildFolder</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#log">log</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#run">run</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#runBabel">runBabel</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#runRequireJs">runRequireJs</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#writeRequireJsConfig">writeRequireJsConfig</a></li><li data-type='method' style='display: none;'><a href="ui.UiBuild.html#.checkBuildFileExists">checkBuildFileExists</a></li></ul></li><li><a href="users.UsersModule.html">UsersModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="users.UsersModule.html#find">find</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#onRequest">onRequest</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#processRequestMiddleware">processRequestMiddleware</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#updateAccess">updateAccess</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="jsonschema.external_Ajv.html">Ajv</a></li><li><a href="jsonschema.external_AjvKeyword.html">AjvKeyword</a></li><li><a href="mongodb.external_MongoDBCollection.html">MongoDBCollection</a></li><li><a href="mongodb.external_MongoDBCreateIndexesOptions.html">MongoDBCreateIndexesOptions</a></li><li><a href="mongodb.external_MongoDBDeleteOptions.html">MongoDBDeleteOptions</a></li><li><a href="mongodb.external_MongoDBFindOneAndReplaceOptions.html">MongoDBFindOneAndReplaceOptions</a></li><li><a href="mongodb.external_MongoDBFindOneAndUpdateOptions.html">MongoDBFindOneAndUpdateOptions</a></li><li><a href="mongodb.external_MongoDBFindOptions.html">MongoDBFindOptions</a></li><li><a href="mongodb.external_MongoDBInsertOneOptions.html">MongoDBInsertOneOptions</a></li><li><a href="mongodb.external_MongoDBMongoClient.html">MongoDBMongoClient</a></li><li><a href="mongodb.external_MongoDBObjectId.html">MongoDBObjectId</a></li><li><a href="server.external_ExpressApp.html">ExpressApp</a></li><li><a href="server.external_ExpressRequest.html">ExpressRequest</a></li><li><a href="server.external_ExpressResponse.html">ExpressResponse</a></li><li><a href="server.external_ExpressRouter.html">ExpressRouter</a></li><li><a href="server.external_HttpServer.html">HttpServer</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">adapt-authoring-contentplugin/lib/ContentPluginModule.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import AbstractApiModule from 'adapt-authoring-api'
import apidefs from './apidefs.js'
import fs from 'fs/promises'
import { glob } from 'glob'
import path from 'path'
import semver from 'semver'
/**
 * Abstract module which handles framework plugins
 * @memberof contentplugin
 * @extends {AbstractApiModule}
 */
class ContentPluginModule extends AbstractApiModule {
  /** @override */
  async setValues () {
    /** @ignore */ this.collectionName = 'contentplugins'
    /** @ignore */ this.root = 'contentplugins'
    /** @ignore */ this.schemaName = 'contentplugin'
    /**
     * Reference to all content plugin schemas, grouped by plugin
     * @type {Object}
     */
    this.pluginSchemas = {}
    /**
     * A list of newly installed plugins
     * @type {Array}
     */
    this.newPlugins = []

    const middleware = await this.app.waitForModule('middleware')

    this.useDefaultRouteConfig()
    // remove unnecessary routes
    delete this.routes.find(r => r.route === '/').handlers.post
    delete this.routes.find(r => r.route === '/:_id').handlers.put
    // extra routes
    this.routes.push({
      route: '/install',
      handlers: {
        post: [
          middleware.fileUploadParser(middleware.zipTypes, { unzip: true }),
          this.installHandler.bind(this)
        ]
      },
      permissions: { post: ['install:contentplugin'] },
      validate: false,
      meta: apidefs.install
    },
    {
      route: '/:_id/update',
      handlers: { post: this.updateHandler.bind(this) },
      permissions: { post: ['update:contentplugin'] },
      meta: apidefs.update
    },
    {
      route: '/:_id/uses',
      handlers: { get: this.usesHandler.bind(this) },
      permissions: { get: ['read:contentplugin'] },
      meta: apidefs.uses
    })
  }

  /** @override */
  async init () {
    await super.init()
    // env var used by the CLI
    if (!process.env.ADAPT_ALLOW_PRERELEASE) {
      process.env.ADAPT_ALLOW_PRERELEASE = 'true'
    }
    const [framework, mongodb] = await this.app.waitForModule('adaptframework', 'mongodb')

    await mongodb.setIndex(this.collectionName, 'name', { unique: true })
    await mongodb.setIndex(this.collectionName, 'displayName', { unique: true })
    await mongodb.setIndex(this.collectionName, 'type')
    /**
     * Cached module instance for easy access
     * @type {AdaptFrameworkModule}
     */
    this.framework = framework

    try {
      await this.initPlugins()
    } catch (e) {
      this.log('error', e)
    }
    this.framework.postInstallHook.tap(this.syncPluginData.bind(this))
    this.framework.postUpdateHook.tap(this.syncPluginData.bind(this))
  }

  /** @override */
  async find (query = {}, options = {}, mongoOptions = {}) {
    const includeUpdateInfo = options.includeUpdateInfo === true || options.includeUpdateInfo === 'true'
    // special option that's passed via query
    delete query.includeUpdateInfo
    const results = await super.find(query, options, mongoOptions)
    if (includeUpdateInfo) {
      const updateInfo = await this.framework.runCliCommand('getPluginUpdateInfos', { plugins: results.map(r => r.name) })
      results.forEach(r => {
        const info = updateInfo.find(i => i.name === r.name)
        if (info) {
          r.canBeUpdated = info.canBeUpdated
          r.latestCompatibleVersion = info.latestCompatibleSourceVersion
          r._cliData = info
        }
      })
    }
    return results
  }

  async readJson(filepath) {
    return JSON.parse(await fs.readFile(filepath))
  }

  /**
   * Inserts a new document or performs an update if matching data already exists
   * @param {Object} data Data to be sent to the DB
   * @param {Object} options Options to pass to the DB function
   * @returns {Promise} Resolves with the returned data
   */
  async insertOrUpdate (data, options = { useDefaults: true }) {
    return !(await this.find({ name: data.name })).length
      ? this.insert(data, options)
      : this.update({ name: data.name }, data, options)
  }

  /** @override */
  async delete (query, options, mongoOptions) {
    const _id = query._id
    const courses = await this.getPluginUses(_id)
    if (courses.length) {
      throw this.app.errors.CONTENTPLUGIN_IN_USE.setData({ courses })
    }
    const [pluginData] = await this.find({ _id })
    // unregister any schemas
    const jsonschema = await this.app.waitForModule('jsonschema')
    const schemaPaths = await glob(`src/*/${pluginData.name}/schema/*.schema.json`, { cwd: this.framework.path, absolute: true })
    schemaPaths.forEach(s => jsonschema.deregisterSchema(s))

    await this.framework.runCliCommand('uninstallPlugins', { plugins: [pluginData.name] })
    this.log('info', `successfully removed plugin ${pluginData.name}`)
    return super.delete(query, options, mongoOptions)
  }

  /**
   * Initialises all framework plugins, from adapt.json and local cache
   * @return {Promise}
   */
  async initPlugins () {
    await this.syncPluginData()

    const missing = await this.getMissingPlugins()
    if (missing.length) { // note we're using CLI directly, as plugins already exist in the DB
      this.log('debug', 'MISSING', missing)
      await this.framework.runCliCommand('installPlugins', { plugins: missing })
    }
    await this.processPluginSchemas()
  }

  /**
   * Makes sure the database plugin data is in sync with the currently installed framework plugins
   */
  async syncPluginData() {
    const dbInfo = (await this.find()).reduce((memo, info) => Object.assign(memo, { [info.name]: info }), {})
    for (const i of await this.framework.runCliCommand('getPluginUpdateInfos')) {
      if(dbInfo[i.name]?.version !== i.matchedVersion) {
        this.log('debug', 'SYNC', i.name, 'local:', dbInfo[i.name]?.version, 'fw:', i.matchedVersion)
        await this.insertOrUpdate({ ...(await i.getInfo()), type: await i.getType(), isLocalInstall: i.isLocalSource })
      }
    }
  }

  /**
   * Returns a list of plugins defined in the database but not installed in the framework
   * @return {Array} List of plugin names mapped to version/dir
   */
  async getMissingPlugins() {
    const dbPlugins = await this.find()
    const fwPlugins = await this.framework.getInstalledPlugins()
    return dbPlugins
      .filter(dbP => !fwPlugins.find(fwP => dbP.name === fwP.name))
      .map(p => `${p.name}@${p.isLocalInstall ? path.join(this.getConfig('pluginDir'), p.name) : p.version}`)
  }

  /**
   * Loads and processes all installed content plugin schemas
   * @param {Array} pluginInfo Plugin info data
   * @return {Promise}
   */
  async processPluginSchemas (pluginInfo) {
    if (!pluginInfo) {
      pluginInfo = await this.framework.runCliCommand('getPluginUpdateInfos')
    }
    const jsonschema = await this.app.waitForModule('jsonschema')
    return Promise.all(pluginInfo.map(async plugin => {
      const name = plugin.name
      const oldSchemaPaths = this.pluginSchemas[name]
      if (oldSchemaPaths) {
        Object.values(oldSchemaPaths).forEach(s => jsonschema.deregisterSchema(s))
        delete this.pluginSchemas[name]
      }
      const schemaPaths = await plugin.getSchemaPaths()
      return Promise.all(schemaPaths.map(async schemaPath => {
        const schema = await this.readJson(schemaPath)
        const source = schema?.$patch?.source?.$ref
        if (source) {
          if (!this.pluginSchemas[name]) this.pluginSchemas[name] = []
          if (this.pluginSchemas[name].includes(schema.$anchor)) jsonschema.deregisterSchema(this.pluginSchemas[name][source])
          this.pluginSchemas[name].push(schema.$anchor)
        }
        return jsonschema.registerSchema(schemaPath, { replace: true })
      }))
    }))
  }

  /**
   * Returns whether a schema is registered by a plugin
   * @param {String} schemaName Name of the schema to check
   * @return {Boolean}
   */
  isPluginSchema (schemaName) {
    for (const p in this.pluginSchemas) {
      if (this.pluginSchemas[p].includes(schemaName)) return true
    }
  }

  /**
   * Returns all schemas registered by a plugin
   * @param {String} pluginName Plugin name
   * @return {Array} List of the plugin's registered schemas
   */
  getPluginSchemas (pluginName) {
    return this.pluginSchemas[pluginName] ?? []
  }

  /**
   * Retrieves the courses in which a plugin is used
   * @param {String} pluginId Plugin _id
   * @returns {Promise} Resolves with an array of course data
   */
  async getPluginUses (pluginId) {
    const [{ name }] = await this.find({ _id: pluginId })
    const [content, db] = await this.app.waitForModule('content', 'mongodb')
    return (db.getCollection(content.collectionName).aggregate([
      { $match: { _type: 'config', _enabledPlugins: name } },
      { $lookup: { from: 'content', localField: '_courseId', foreignField: '_id', as: 'course' } },
      { $unwind: '$course' },
      { $replaceRoot: { newRoot: '$course' } },
      { $lookup: { from: 'users', localField: 'createdBy', foreignField: '_id', as: 'createdBy' } },
      { $project: { title: 1, createdBy: { $map: { input: '$createdBy', as: 'user', in: '$$user.email' } } } },
      { $unwind: '$createdBy' }
    ])).toArray()
  }

  /**
   * Installs new plugins
   * @param {Array[]} plugins 2D array of strings in the format [pluginName, versionOrPath]
   * @param {Object} options
   * @param {Boolean} options.force Whether the plugin should be 'force' installed if version is lower than the existing
   * @param {Boolean} options.strict Whether the function should fail on error
   */
  async installPlugins (plugins, options = { strict: false, force: false }) {
    const errors = []
    const installed = []
    await Promise.all(plugins.map(async ([name, versionOrPath]) => {
      try {
        const data = await this.installPlugin(name, versionOrPath, options)
        installed.push(data)
        this.log('info', 'PLUGIN_INSTALL', `${data.name}@${data.version}`)
      } catch (e) {
        this.log('warn', 'PLUGIN_INSTALL_FAIL', name, e?.data?.error ?? e)
        errors.push(e)
      }
    }))
    if (errors.length &amp;&amp; options.strict) {
      throw this.app.errors.CONTENTPLUGIN_INSTALL_FAILED
        .setData({ errors })
    }
    return installed
  }

  /**
   * Installs a single plugin. Note: this function is called by installPlugins and should not be called directly.
   * @param {String} pluginName Name of the plugin to install
   * @param {String} versionOrPath The semver-formatted version, or the path to the plugin source
   * @param {Object} options
   * @param {Boolean} options.force Whether the plugin should be 'force' installed if version is lower than the existing
   * @param {Boolean} options.strict Whether the function should fail on error
   * @returns Resolves with plugin DB data
   */
  async installPlugin (pluginName, versionOrPath, options = { strict: false, force: false }) {
    const [pluginData] = await this.find({ name: pluginName }, { includeUpdateInfo: true })
    const { name, version, sourcePath, isLocalInstall } = await this.processPluginFiles({ ...pluginData, sourcePath: versionOrPath })

    if (pluginData) {
      if (!options.force &amp;&amp; semver.lte(version, pluginData.version)) {
        throw this.app.errors.CONTENTPLUGIN_ALREADY_EXISTS
          .setData({ name: pluginData.name, version: pluginData.version })
      }
      fs.rm
    }
    const [data] = await this.framework.runCliCommand('installPlugins', { plugins: [`${name}@${sourcePath ?? version}`] })
    const info = await this.insertOrUpdate({
      ...(await data.getInfo()),
      type: await data.getType(),
      isLocalInstall
    })
    if (!data.isInstallSuccessful) {
      throw this.app.errors.CONTENTPLUGIN_CLI_INSTALL_FAILED
        .setData({ name })
    }
    if (!info.targetAttribute) {
      throw this.app.errors.CONTENTPLUGIN_ATTR_MISSING
        .setData({ name })
    }
    await this.processPluginSchemas([data])
    return info
  }

  /**
   * Ensures local plugin source files are stored in the correct location and structured in an expected way
   * @param {Object} pluginData Plugin metadata
   * @param {String} sourcePath The path to the plugin source files
   * @returns Resolves with package data
   */
  async processPluginFiles (pluginData) {
    let sourcePath = pluginData.sourcePath
    if (sourcePath === path.basename(sourcePath)) { // no local files
      return { name: pluginData.name, version: sourcePath, isLocalInstall: false }
    }
    const contents = await fs.readdir(sourcePath)
    if (contents.length === 1) { // deal with a nested root folder
      sourcePath = path.join(pluginData.sourcePath, contents[0])
    }
    let pkg
    try { // load package data, with fall-back to bower
      try {
        pkg = await this.readJson(path.join(sourcePath, 'package.json'))
      } catch (e) {
        pkg = await this.readJson(path.join(sourcePath, 'bower.json'))
      }
      pkg.sourcePath = path.join(this.getConfig('pluginDir'), pkg.name)
      pkg.isLocalInstall = true
    } catch (e) {
      throw this.app.errors.CONTENTPLUGIN_INVALID_ZIP
    }
    // move the files into the persistent location
    await fs.cp(sourcePath, pkg.sourcePath, { recursive: true })
    await fs.rm(sourcePath, { recursive: true })
    return pkg
  }

  /**
   * Updates a single plugin
   * @param {String} _id The _id for the plugin to update
   * @return Resolves with update data
   */
  async updatePlugin (_id) {
    const [{ name }] = await this.find({ _id })
    const [pluginData] = await this.framework.runCliCommand({ plugins: [name] })
    const p = await this.update({ name }, pluginData._sourceInfo)
    this.log('info', `successfully updated plugin ${p.name}@${p.version}`)
    return p
  }

  /** @override */
  serveSchema () {
    return async (req, res, next) => {
      try {
        const plugin = await this.get({ name: req.apiData.query.type }) || {}
        const schema = await this.getSchema(plugin.schemaName)
        if (!schema) {
          return res.sendError(this.app.errors.NOT_FOUND.setData({ type: 'schema', id: plugin.schemaName }))
        }
        res.type('application/schema+json').json(schema)
      } catch (e) {
        return next(e)
      }
    }
  }

  /**
   * Express request handler for installing a plugin (also used for updating via zip upload).
   * @param {external:ExpressRequest} req
   * @param {external:ExpressResponse} res
   * @param {Function} next
   */
  async installHandler (req, res, next) {
    try {
      const [pluginData] = await this.installPlugins([
        [
          req.body.name,
          req?.fileUpload?.files?.file?.[0]?.filepath ?? req.body.version
        ]
      ], {
        force: req.body.force === 'true' || req.body.force === true,
        strict: true
      })
      res.status(this.mapStatusCode('post')).send(pluginData)
    } catch (error) {
      if (error.code === this.app.errors.CONTENTPLUGIN_INSTALL_FAILED.code) {
        error.data.errors = error.data.errors.map(req.translate)
      }
      res.sendError(error)
    }
  }

  /**
   * Express request handler for updating a plugin
   * @param {external:ExpressRequest} req
   * @param {external:ExpressResponse} res
   * @param {Function} next
   */
  async updateHandler (req, res, next) {
    try {
      const pluginData = await this.updatePlugin(req.params._id)
      res.status(this.mapStatusCode('put')).send(pluginData)
    } catch (error) {
      return next(error)
    }
  }

  /**
   * Express request handler for retrieving uses of a single plugin
   * @param {external:ExpressRequest} req
   * @param {external:ExpressResponse} res
   * @param {Function} next
   */
  async usesHandler (req, res, next) {
    try {
      const data = await this.getPluginUses(req.params._id)
      res.status(this.mapStatusCode('put')).send(data)
    } catch (error) {
      return next(error)
    }
  }
}

export default ContentPluginModule
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Fri Jan 16 2026 13:58:08 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


    <link type="text/css" rel="stylesheet" href="styles/adapt.css">
    
    <script src="scripts/adapt.js"></script>
    
</body>
</html>
