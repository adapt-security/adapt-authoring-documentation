<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>adapt-authoring-adaptframework/lib/AdaptFrameworkImport.js - Adapt authoring tool UI documentation</title>
    
    <meta name="description" content="Adapt authoring tool UI documentation" />
    
        <meta name="keywords" content="v1.0.0-rc.6" />
        <meta name="keyword" content="v1.0.0-rc.6" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a class="menu-title" ><img class="logo" src="assets/logo-outline-colour.png" />Adapt authoring tool back-end API documentation<br><span class="version">v1.0.0-rc.6</span></a></h2><h2><a href="https://adapt-security.github.io/adapt-authoring-documentation/" target="_self" class="menu-item" id="home_link" >Documentation home</a></h2><h2><a href="https://www.adaptlearning.org/" target="_blank" class="menu-item" id="website_link" >Project Website</a></h2><h2><a href="https://community.adaptlearning.org/mod/forum/view.php?id=4" target="_blank" class="menu-item" id="forum_link" >Technical Discussion Forum</a></h2><h3>Namespaces</h3><ul><li><a href="adaptframework.html">adaptframework</a></li><li><a href="assets.html">assets</a></li><li><a href="auth.html">auth</a></li><li><a href="authored.html">authored</a></li><li><a href="browserslist.html">browserslist</a></li><li><a href="config.html">config</a></li><li><a href="content.html">content</a></li><li><a href="contentplugin.html">contentplugin</a></li><li><a href="core.html">core</a></li><li><a href="courseassets.html">courseassets</a></li><li><a href="coursetheme.html">coursetheme</a></li><li><a href="defaultplugins.html">defaultplugins</a></li><li><a href="errors.html">errors</a></li><li><a href="jsonschema.html">jsonschema</a></li><li><a href="lang.html">lang</a></li><li><a href="localauth.html">localauth</a></li><li><a href="logger.html">logger</a></li><li><a href="mailer.html">mailer</a></li><li><a href="middleware.html">middleware</a></li><li><a href="mongodb.html">mongodb</a></li><li><a href="mongodblogger.html">mongodblogger</a></li><li><a href="roles.html">roles</a></li><li><a href="server.html">server</a></li><li><a href="sessions.html">sessions</a></li><li><a href="spoortracking.html">spoortracking</a></li><li><a href="tags.html">tags</a></li><li><a href="users.html">users</a></li></ul><h3>Classes</h3><ul><li><a href="AdaptFrameworkBuildOptions.html">AdaptFrameworkBuildOptions</a></li><li><a href="AdaptFrameworkImportOptions.html">AdaptFrameworkImportOptions</a></li><li><a href="adaptframework.AdaptFrameworkBuild.html">AdaptFrameworkBuild</a><ul class='methods'><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#build">build</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#cachePluginData">cachePluginData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#copyAssets">copyAssets</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#createIdMap">createIdMap</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#ensureDir">ensureDir</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#loadAssetData">loadAssetData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#loadCourseData">loadCourseData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#prepareZip">prepareZip</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#recordBuildAttempt">recordBuildAttempt</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#removeOldBuilds">removeOldBuilds</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#sortContentItems">sortContentItems</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#transformContentItems">transformContentItems</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#writeContentJson">writeContentJson</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#.getBuildExpiry">getBuildExpiry</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkBuild.html#.run">run</a></li></ul></li><li><a href="adaptframework.AdaptFrameworkImport.html">AdaptFrameworkImport</a><ul class='methods'><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#cleanUp">cleanUp</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#convertSchemas">convertSchemas</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#extractAssets">extractAssets</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#generateSummary">generateSummary</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#getSortedData">getSortedData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#import">import</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#importContentObject">importContentObject</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#importCourseAssets">importCourseAssets</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#importCourseData">importCourseData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#importCoursePlugins">importCoursePlugins</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#importTags">importTags</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#loadAssetData">loadAssetData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#loadContentFile">loadContentFile</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#loadCourseData">loadCourseData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#loadPluginData">loadPluginData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#migrateCourseData">migrateCourseData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#patchCustomStyle">patchCustomStyle</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#patchThemeName">patchThemeName</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#prepare">prepare</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#runGruntMigration">runGruntMigration</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#transformData">transformData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#.run">run</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkImport.html#.typeToSchema">typeToSchema</a></li></ul></li><li><a href="adaptframework.AdaptFrameworkModule.html">AdaptFrameworkModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#buildCourse">buildCourse</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#checkContentAccess">checkContentAccess</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#getInstalledPlugins">getInstalledPlugins</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#getLatestVersion">getLatestVersion</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#getManifestPlugins">getManifestPlugins</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#importCourse">importCourse</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#initRoutes">initRoutes</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#installFramework">installFramework</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#loadSchemas">loadSchemas</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#logStatus">logStatus</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkModule.html#updateFramework">updateFramework</a></li></ul></li><li><a href="adaptframework.AdaptFrameworkUtils.html">AdaptFrameworkUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.copyFrameworkSource">copyFrameworkSource</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.getHandler">getHandler</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.getImportContentCounts">getImportContentCounts</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.getPluginUpdateStatus">getPluginUpdateStatus</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.getUpdateHandler">getUpdateHandler</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.handleImportFile">handleImportFile</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.importHandler">importHandler</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.inferBuildAction">inferBuildAction</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.log">log</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.postHandler">postHandler</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.postUpdateHandler">postUpdateHandler</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.retrieveBuildData">retrieveBuildData</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.runCliCommand">runCliCommand</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.slugifyTitle">slugifyTitle</a></li><li data-type='method' style='display: none;'><a href="adaptframework.AdaptFrameworkUtils.html#.toBoolean">toBoolean</a></li></ul></li><li><a href="api.AbstractApiModule.html">AbstractApiModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#addRoute">addRoute</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#addRoutes">addRoutes</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#checkAccess">checkAccess</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#deleteMany">deleteMany</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#find">find</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#findOne">findOne</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#getSchema">getSchema</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#getSchemaName">getSchemaName</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#mapStatusCode">mapStatusCode</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#parseQuery">parseQuery</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#processRequestMiddleware">processRequestMiddleware</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#queryHandler">queryHandler</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#requestHandler">requestHandler</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#sanitise">sanitise</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#sanitiseRequestDataMiddleware">sanitiseRequestDataMiddleware</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#serveSchema">serveSchema</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#setDefaultOptions">setDefaultOptions</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#setUpPagination">setUpPagination</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#update">update</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#updateMany">updateMany</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#useDefaultRouteConfig">useDefaultRouteConfig</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#validate">validate</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiModule.html#validateValues">validateValues</a></li></ul></li><li><a href="api.AbstractApiUtils.html">AbstractApiUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.AbstractApiUtils.html#.argsFromReq">argsFromReq</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiUtils.html#.generateApiMetadata">generateApiMetadata</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiUtils.html#.httpMethodToAction">httpMethodToAction</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiUtils.html#.httpMethodToDBFunction">httpMethodToDBFunction</a></li><li data-type='method' style='display: none;'><a href="api.AbstractApiUtils.html#.stringifyValues">stringifyValues</a></li></ul></li><li><a href="api.DataCache.html">DataCache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="api.DataCache.html#get">get</a></li><li data-type='method' style='display: none;'><a href="api.DataCache.html#prune">prune</a></li></ul></li><li><a href="assets.AbstractAsset.html">AbstractAsset</a><ul class='members'><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#assetRoot">assetRoot</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#hasThumb">hasThumb</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#isAudio">isAudio</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#isImage">isImage</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#isVideo">isVideo</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#path">path</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#thumb">thumb</a></li><li data-type='member' style='display: none;'><a href="assets.AbstractAsset.html#.name">name</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#ensureDir">ensureDir</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#ensureExists">ensureExists</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#generateThumb">generateThumb</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#getFileExtension">getFileExtension</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#move">move</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#read">read</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#resolvePath">resolvePath</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#updateFile">updateFile</a></li><li data-type='method' style='display: none;'><a href="assets.AbstractAsset.html#write">write</a></li></ul></li><li><a href="assets.Assetsmodule.html">Assetsmodule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#createFsWrapper">createFsWrapper</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#deleteMany">deleteMany</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#find">find</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#onRequest">onRequest</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#performHousekeeping">performHousekeeping</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#registerAssetType">registerAssetType</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#serveAssetHandler">serveAssetHandler</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="assets.Assetsmodule.html#update">update</a></li></ul></li><li><a href="assets.LocalAsset.html">LocalAsset</a><ul class='members'><li data-type='member' style='display: none;'><a href="assets.LocalAsset.html#assetRoot">assetRoot</a></li><li data-type='member' style='display: none;'><a href="assets.LocalAsset.html#dirname">dirname</a></li><li data-type='member' style='display: none;'><a href="assets.LocalAsset.html#filename">filename</a></li><li data-type='member' style='display: none;'><a href="assets.LocalAsset.html#.name">name</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#ensureDir">ensureDir</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#ensureExists">ensureExists</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#move">move</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#read">read</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#resolvePath">resolvePath</a></li><li data-type='method' style='display: none;'><a href="assets.LocalAsset.html#write">write</a></li></ul></li><li><a href="auth.AbstractAuthModule.html">AbstractAuthModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#authenticate">authenticate</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#authenticateHandler">authenticateHandler</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#disavowUser">disavowUser</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#enableHandler">enableHandler</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#register">register</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#registerHandler">registerHandler</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#secureRoute">secureRoute</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#setUserEnabled">setUserEnabled</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="auth.AbstractAuthModule.html#unsecureRoute">unsecureRoute</a></li></ul></li><li><a href="auth.AuthModule.html">AuthModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#apiMiddleware">apiMiddleware</a></li><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#initAuthData">initAuthData</a></li><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#rootMiddleware">rootMiddleware</a></li><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#secureRoute">secureRoute</a></li><li data-type='method' style='display: none;'><a href="auth.AuthModule.html#unsecureRoute">unsecureRoute</a></li></ul></li><li><a href="auth.AuthToken.html">AuthToken</a><ul class='members'><li data-type='member' style='display: none;'><a href="auth.AuthToken.html#.secret">secret</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.decode">decode</a></li><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.find">find</a></li><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.generate">generate</a></li><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.initRequestData">initRequestData</a></li><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.isSuper">isSuper</a></li><li data-type='method' style='display: none;'><a href="auth.AuthToken.html#.revoke">revoke</a></li></ul></li><li><a href="auth.AuthUtils.html">AuthUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.AuthUtils.html#.createEmptyStore">createEmptyStore</a></li><li data-type='method' style='display: none;'><a href="auth.AuthUtils.html#.getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="auth.AuthUtils.html#.initAuthData">initAuthData</a></li><li data-type='method' style='display: none;'><a href="auth.AuthUtils.html#.log">log</a></li></ul></li><li><a href="auth.Authentication.html">Authentication</a><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.Authentication.html#checkHandler">checkHandler</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#disavowHandler">disavowHandler</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#disavowUser">disavowUser</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#generateTokenHandler">generateTokenHandler</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#init">init</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#registerPlugin">registerPlugin</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#registerSchema">registerSchema</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#registerUser">registerUser</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#retrieveTokensHandler">retrieveTokensHandler</a></li><li data-type='method' style='display: none;'><a href="auth.Authentication.html#.init">init</a></li></ul></li><li><a href="auth.Permissions.html">Permissions</a><ul class='methods'><li data-type='method' style='display: none;'><a href="auth.Permissions.html#check">check</a></li><li data-type='method' style='display: none;'><a href="auth.Permissions.html#checkRoutes">checkRoutes</a></li><li data-type='method' style='display: none;'><a href="auth.Permissions.html#getScopesForRoute">getScopesForRoute</a></li><li data-type='method' style='display: none;'><a href="auth.Permissions.html#secureRoute">secureRoute</a></li><li data-type='method' style='display: none;'><a href="auth.Permissions.html#.init">init</a></li></ul></li><li><a href="authored.AuthoredModule.html">AuthoredModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="authored.AuthoredModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="authored.AuthoredModule.html#registerModule">registerModule</a></li><li data-type='method' style='display: none;'><a href="authored.AuthoredModule.html#registerSchemas">registerSchemas</a></li><li data-type='method' style='display: none;'><a href="authored.AuthoredModule.html#updateAuthor">updateAuthor</a></li><li data-type='method' style='display: none;'><a href="authored.AuthoredModule.html#updateTimestamps">updateTimestamps</a></li></ul></li><li><a href="browserslist.BrowserslistModule.html">BrowserslistModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="browserslist.BrowserslistModule.html#init">init</a></li></ul></li><li><a href="config.ConfigModule.html">ConfigModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#envVarToConfigKey">envVarToConfigKey</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#get">get</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#getPublicConfig">getPublicConfig</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#has">has</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#initRouter">initRouter</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#processModuleSchema">processModuleSchema</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#set">set</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#storeEnvSettings">storeEnvSettings</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#storeSchemaSettings">storeSchemaSettings</a></li><li data-type='method' style='display: none;'><a href="config.ConfigModule.html#storeUserSettings">storeUserSettings</a></li></ul></li><li><a href="content.ContentModule.html">ContentModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="content.ContentModule.html#clone">clone</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#getDescendants">getDescendants</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#getSchema">getSchema</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#getSchemaName">getSchemaName</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#handleClone">handleClone</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#handleInsertRecursive">handleInsertRecursive</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#insertRecursive">insertRecursive</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#registerConfigSchemas">registerConfigSchemas</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#update">update</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#updateEnabledPlugins">updateEnabledPlugins</a></li><li data-type='method' style='display: none;'><a href="content.ContentModule.html#updateSortOrder">updateSortOrder</a></li></ul></li><li><a href="contentplugin.ContentPluginModule.html">ContentPluginModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#find">find</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#getMissingPlugins">getMissingPlugins</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#getPluginSchemas">getPluginSchemas</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#getPluginUses">getPluginUses</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#initPlugins">initPlugins</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#insertOrUpdate">insertOrUpdate</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#installHandler">installHandler</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#installPlugin">installPlugin</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#installPlugins">installPlugins</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#isPluginSchema">isPluginSchema</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#processPluginFiles">processPluginFiles</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#processPluginSchemas">processPluginSchemas</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#serveSchema">serveSchema</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#syncPluginData">syncPluginData</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#updateHandler">updateHandler</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#updatePlugin">updatePlugin</a></li><li data-type='method' style='display: none;'><a href="contentplugin.ContentPluginModule.html#usesHandler">usesHandler</a></li></ul></li><li><a href="core.AbstractModule.html">AbstractModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="core.AbstractModule.html#getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="core.AbstractModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="core.AbstractModule.html#log">log</a></li><li data-type='method' style='display: none;'><a href="core.AbstractModule.html#onReady">onReady</a></li><li data-type='method' style='display: none;'><a href="core.AbstractModule.html#setReady">setReady</a></li></ul></li><li><a href="core.App.html">App</a><ul class='members'><li data-type='member' style='display: none;'><a href="core.App.html#app">app</a></li><li data-type='member' style='display: none;'><a href="core.App.html#args">args</a></li><li data-type='member' style='display: none;'><a href="core.App.html#dependencies">dependencies</a></li><li data-type='member' style='display: none;'><a href="core.App.html#dependencyloader">dependencyloader</a></li><li data-type='member' style='display: none;'><a href="core.App.html#.instance">instance</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="core.App.html#getGitInfo">getGitInfo</a></li><li data-type='method' style='display: none;'><a href="core.App.html#init">init</a></li><li data-type='method' style='display: none;'><a href="core.App.html#setReady">setReady</a></li><li data-type='method' style='display: none;'><a href="core.App.html#start">start</a></li><li data-type='method' style='display: none;'><a href="core.App.html#waitForModule">waitForModule</a></li></ul></li><li><a href="core.DependencyLoader.html">DependencyLoader</a><ul class='methods'><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#load">load</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#loadConfigs">loadConfigs</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#loadModule">loadModule</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#loadModuleConfig">loadModuleConfig</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#loadModules">loadModules</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#logError">logError</a></li><li data-type='method' style='display: none;'><a href="core.DependencyLoader.html#waitForModule">waitForModule</a></li></ul></li><li><a href="core.Hook.html">Hook</a><ul class='members'><li data-type='member' style='display: none;'><a href="core.Hook.html#hasObservers">hasObservers</a></li><li data-type='member' style='display: none;'><a href="core.Hook.html#.Types">Types</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="core.Hook.html#invoke">invoke</a></li><li data-type='method' style='display: none;'><a href="core.Hook.html#onInvoke">onInvoke</a></li><li data-type='method' style='display: none;'><a href="core.Hook.html#tap">tap</a></li><li data-type='method' style='display: none;'><a href="core.Hook.html#untap">untap</a></li></ul></li><li><a href="core.Utils.html">Utils</a><ul class='members'><li data-type='member' style='display: none;'><a href="core.Utils.html#.metadataFileName">metadataFileName</a></li><li data-type='member' style='display: none;'><a href="core.Utils.html#.packageFileName">packageFileName</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="core.Utils.html#.getArgs">getArgs</a></li><li data-type='method' style='display: none;'><a href="core.Utils.html#.isObject">isObject</a></li><li data-type='method' style='display: none;'><a href="core.Utils.html#.spawn">spawn</a></li></ul></li><li><a href="courseassets.CourseAssetsModule.html">CourseAssetsModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="courseassets.CourseAssetsModule.html#extractAssetIds">extractAssetIds</a></li><li data-type='method' style='display: none;'><a href="courseassets.CourseAssetsModule.html#handleContentEvent">handleContentEvent</a></li><li data-type='method' style='display: none;'><a href="courseassets.CourseAssetsModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="courseassets.CourseAssetsModule.html#setValues">setValues</a></li></ul></li><li><a href="coursetheme.CourseThemeModule.html">CourseThemeModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#applyHandler">applyHandler</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#getVariablesString">getVariablesString</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#processFileVariables">processFileVariables</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#removeHandler">removeHandler</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#writeCustomLess">writeCustomLess</a></li><li data-type='method' style='display: none;'><a href="coursetheme.CourseThemeModule.html#writeFile">writeFile</a></li></ul></li><li><a href="defaultplugins.DefaultPluginsModule.html">DefaultPluginsModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="defaultplugins.DefaultPluginsModule.html#init">init</a></li></ul></li><li><a href="errors.AdaptError.html">AdaptError</a><ul class='methods'><li data-type='method' style='display: none;'><a href="errors.AdaptError.html#setData">setData</a></li><li data-type='method' style='display: none;'><a href="errors.AdaptError.html#toString">toString</a></li></ul></li><li><a href="errors.ErrorModule.html">ErrorModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="errors.ErrorModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="errors.ErrorModule.html#loadErrors">loadErrors</a></li></ul></li><li><a href="jsonschema.JsonSchema.html">JsonSchema</a><ul class='methods'><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#addExtension">addExtension</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#build">build</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#getObjectDefaults">getObjectDefaults</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#getParent">getParent</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#isBuildValid">isBuildValid</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#load">load</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#patch">patch</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#sanitise">sanitise</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchema.html#validate">validate</a></li></ul></li><li><a href="jsonschema.JsonSchemaModule.html">JsonSchemaModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#addKeyword">addKeyword</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#addStringFormats">addStringFormats</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#createSchema">createSchema</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#deregisterSchema">deregisterSchema</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#extendSchema">extendSchema</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#getSchema">getSchema</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#logSchemas">logSchemas</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#registerSchema">registerSchema</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#registerSchemas">registerSchemas</a></li><li data-type='method' style='display: none;'><a href="jsonschema.JsonSchemaModule.html#resetSchemaRegistry">resetSchemaRegistry</a></li></ul></li><li><a href="jsonschema.Keywords.html">Keywords</a></li><li><a href="lang.LangModule.html">LangModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="lang.LangModule.html#addTranslationUtils">addTranslationUtils</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#getPhrasesForLang">getPhrasesForLang</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#loadPhrases">loadPhrases</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#loadPhrasesForDir">loadPhrasesForDir</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#loadRoutes">loadRoutes</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#requestHandler">requestHandler</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#translate">translate</a></li><li data-type='method' style='display: none;'><a href="lang.LangModule.html#translateError">translateError</a></li></ul></li><li><a href="localauth.LocalAuthModule.html">LocalAuthModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#authenticate">authenticate</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#changePasswordHandler">changePasswordHandler</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#createPasswordReset">createPasswordReset</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#forgotPasswordHandler">forgotPasswordHandler</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#handleLockStatus">handleLockStatus</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#inviteHandler">inviteHandler</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#register">register</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#registerSuper">registerSuper</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#registerSuperHandler">registerSuperHandler</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#setUserEnabled">setUserEnabled</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#updateUser">updateUser</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#validatePasswordHandler">validatePasswordHandler</a></li><li data-type='method' style='display: none;'><a href="localauth.LocalAuthModule.html#.formatRemainingTime">formatRemainingTime</a></li></ul></li><li><a href="localauth.PasswordUtils.html">PasswordUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.compare">compare</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.createReset">createReset</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.deleteReset">deleteReset</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.generate">generate</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.getRandomHex">getRandomHex</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.validate">validate</a></li><li data-type='method' style='display: none;'><a href="localauth.PasswordUtils.html#.validateReset">validateReset</a></li></ul></li><li><a href="logger.LoggerModule.html">LoggerModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#getModuleOverrides">getModuleOverrides</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#isLevelEnabled">isLevelEnabled</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#isLoggingEnabled">isLoggingEnabled</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#log">log</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#.colourise">colourise</a></li><li data-type='method' style='display: none;'><a href="logger.LoggerModule.html#.getDateStamp">getDateStamp</a></li></ul></li><li><a href="mailer.AbstractMailTransport.html">AbstractMailTransport</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mailer.AbstractMailTransport.html#getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="mailer.AbstractMailTransport.html#send">send</a></li><li data-type='method' style='display: none;'><a href="mailer.AbstractMailTransport.html#test">test</a></li></ul></li><li><a href="mailer.FilesystemTransport.html">FilesystemTransport</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mailer.FilesystemTransport.html#send">send</a></li><li data-type='method' style='display: none;'><a href="mailer.FilesystemTransport.html#test">test</a></li></ul></li><li><a href="mailer.MailerModule.html">MailerModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mailer.MailerModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="mailer.MailerModule.html#send">send</a></li><li data-type='method' style='display: none;'><a href="mailer.MailerModule.html#testEmailHandler">testEmailHandler</a></li></ul></li><li><a href="mailer.SmtpTransport.html">SmtpTransport</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mailer.SmtpTransport.html#send">send</a></li><li data-type='method' style='display: none;'><a href="mailer.SmtpTransport.html#test">test</a></li></ul></li><li><a href="middleware.MiddlewareModule.html">MiddlewareModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#bodyParserJson">bodyParserJson</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#bodyParserUrlEncoded">bodyParserUrlEncoded</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#fileUploadParser">fileUploadParser</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#rateLimiter">rateLimiter</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#setDefaultFileOptions">setDefaultFileOptions</a></li><li data-type='method' style='display: none;'><a href="middleware.MiddlewareModule.html#urlUploadParser">urlUploadParser</a></li></ul></li><li><a href="module.exports.html">exports</a></li><li><a href="mongodb.MongoDBModule.html">MongoDBModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#deleteMany">deleteMany</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#find">find</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#getCollection">getCollection</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#getError">getError</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#getStats">getStats</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#parseOptions">parseOptions</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#replace">replace</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#setIndex">setIndex</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#update">update</a></li><li data-type='method' style='display: none;'><a href="mongodb.MongoDBModule.html#updateMany">updateMany</a></li></ul></li><li><a href="mongodb.ObjectIdUtils.html">ObjectIdUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mongodb.ObjectIdUtils.html#.addSchemaKeyword">addSchemaKeyword</a></li><li data-type='method' style='display: none;'><a href="mongodb.ObjectIdUtils.html#.create">create</a></li><li data-type='method' style='display: none;'><a href="mongodb.ObjectIdUtils.html#.isValid">isValid</a></li><li data-type='method' style='display: none;'><a href="mongodb.ObjectIdUtils.html#.parse">parse</a></li><li data-type='method' style='display: none;'><a href="mongodb.ObjectIdUtils.html#.parseIds">parseIds</a></li></ul></li><li><a href="mongodblogger.MongoDBLoggerModule.html">MongoDBLoggerModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="mongodblogger.MongoDBLoggerModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="mongodblogger.MongoDBLoggerModule.html#logToDb">logToDb</a></li><li data-type='method' style='display: none;'><a href="mongodblogger.MongoDBLoggerModule.html#setValues">setValues</a></li></ul></li><li><a href="roles.RolesModule.html">RolesModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#getScopesForRole">getScopesForRole</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#initConfigRoles">initConfigRoles</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#initDefaultRoles">initDefaultRoles</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#onUpdateRoles">onUpdateRoles</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="roles.RolesModule.html#shortNamesToIds">shortNamesToIds</a></li></ul></li><li><a href="server.Router.html">Router</a><ul class='methods'><li data-type='method' style='display: none;'><a href="server.Router.html#addHandlerMiddleware">addHandlerMiddleware</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#addMiddleware">addMiddleware</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#addRoute">addRoute</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#createChildRouter">createChildRouter</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#flattenRouters">flattenRouters</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#getHandlerMiddleware">getHandlerMiddleware</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#init">init</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#log">log</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#validateRoute">validateRoute</a></li><li data-type='method' style='display: none;'><a href="server.Router.html#warnOnInited">warnOnInited</a></li></ul></li><li><a href="server.ServerModule.html">ServerModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="server.ServerModule.html#close">close</a></li><li data-type='method' style='display: none;'><a href="server.ServerModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="server.ServerModule.html#listen">listen</a></li><li data-type='method' style='display: none;'><a href="server.ServerModule.html#start">start</a></li><li data-type='method' style='display: none;'><a href="server.ServerModule.html#static">static</a></li></ul></li><li><a href="server.ServerUtils.html">ServerUtils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.addErrorHandler">addErrorHandler</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.addExistenceProps">addExistenceProps</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.apiNotFoundHandler">apiNotFoundHandler</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.cacheRouteConfig">cacheRouteConfig</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.debugRequestTime">debugRequestTime</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.generateRouterMap">generateRouterMap</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.genericErrorHandler">genericErrorHandler</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.handleInternalRoutes">handleInternalRoutes</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.mapHandler">mapHandler</a></li><li data-type='method' style='display: none;'><a href="server.ServerUtils.html#.rootNotFoundHandler">rootNotFoundHandler</a></li></ul></li><li><a href="sessions.SessionsModule.html">SessionsModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="sessions.SessionsModule.html#clearSession">clearSession</a></li><li data-type='method' style='display: none;'><a href="sessions.SessionsModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="sessions.SessionsModule.html#storeAuthHeader">storeAuthHeader</a></li></ul></li><li><a href="spoortracking.SpoorTrackingModule.html">SpoorTrackingModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="spoortracking.SpoorTrackingModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="spoortracking.SpoorTrackingModule.html#insertTrackingId">insertTrackingId</a></li><li data-type='method' style='display: none;'><a href="spoortracking.SpoorTrackingModule.html#resetCourseTrackingIds">resetCourseTrackingIds</a></li><li data-type='method' style='display: none;'><a href="spoortracking.SpoorTrackingModule.html#resetTrackingHandler">resetTrackingHandler</a></li></ul></li><li><a href="tags.TagsModule.html">TagsModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#autocompleteHandler">autocompleteHandler</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#delete">delete</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#registerModule">registerModule</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#registerSchema">registerSchema</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#registerSchemas">registerSchemas</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="tags.TagsModule.html#transferHandler">transferHandler</a></li></ul></li><li><a href="ui.UiModule.html">UiModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ui.UiModule.html#addUiPlugin">addUiPlugin</a></li><li data-type='method' style='display: none;'><a href="ui.UiModule.html#build">build</a></li><li data-type='method' style='display: none;'><a href="ui.UiModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="ui.UiModule.html#servePage">servePage</a></li></ul></li><li><a href="users.UsersModule.html">UsersModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="users.UsersModule.html#find">find</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#init">init</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#insert">insert</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#onRequest">onRequest</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#processRequestMiddleware">processRequestMiddleware</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#setValues">setValues</a></li><li data-type='method' style='display: none;'><a href="users.UsersModule.html#updateAccess">updateAccess</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="jsonschema.external_Ajv.html">Ajv</a></li><li><a href="jsonschema.external_AjvKeyword.html">AjvKeyword</a></li><li><a href="mongodb.external_MongoDBCollection.html">MongoDBCollection</a></li><li><a href="mongodb.external_MongoDBCreateIndexesOptions.html">MongoDBCreateIndexesOptions</a></li><li><a href="mongodb.external_MongoDBDeleteOptions.html">MongoDBDeleteOptions</a></li><li><a href="mongodb.external_MongoDBFindOneAndReplaceOptions.html">MongoDBFindOneAndReplaceOptions</a></li><li><a href="mongodb.external_MongoDBFindOneAndUpdateOptions.html">MongoDBFindOneAndUpdateOptions</a></li><li><a href="mongodb.external_MongoDBFindOptions.html">MongoDBFindOptions</a></li><li><a href="mongodb.external_MongoDBInsertOneOptions.html">MongoDBInsertOneOptions</a></li><li><a href="mongodb.external_MongoDBMongoClient.html">MongoDBMongoClient</a></li><li><a href="mongodb.external_MongoDBObjectId.html">MongoDBObjectId</a></li><li><a href="mongodb.external_MongoDBUpdateOptions.html">MongoDBUpdateOptions</a></li><li><a href="server.external_ExpressApp.html">ExpressApp</a></li><li><a href="server.external_ExpressRequest.html">ExpressRequest</a></li><li><a href="server.external_ExpressResponse.html">ExpressResponse</a></li><li><a href="server.external_ExpressRouter.html">ExpressRouter</a></li><li><a href="server.external_HttpServer.html">HttpServer</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">adapt-authoring-adaptframework/lib/AdaptFrameworkImport.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { App, Hook, Utils } from 'adapt-authoring-core'
import fs from 'fs/promises'
import { glob } from 'glob'
import octopus from 'adapt-octopus'
import path from 'upath'
import { randomBytes } from 'node:crypto'
import semver from 'semver'
import { unzip } from 'zipper'
import FWUtils from './AdaptFrameworkUtils.js'

import ComponentTransform from './migrations/component.js'
import ConfigTransform from './migrations/config.js'
import GraphicSrcTransform from './migrations/graphic-src.js'
import NavOrderTransform from './migrations/nav-order.js'
import ParentIdTransform from './migrations/parent-id.js'
import RemoveUndefTransform from './migrations/remove-undef.js'
import StartPageTransform from './migrations/start-page.js'
import ThemeUndefTransform from './migrations/theme-undef.js'

const ContentMigrations = [
  ComponentTransform,
  ConfigTransform,
  GraphicSrcTransform,
  NavOrderTransform,
  ParentIdTransform,
  RemoveUndefTransform,
  StartPageTransform,
  ThemeUndefTransform
]

/**
 * Handles the Adapt framework import process
 * @memberof adaptframework
 */
class AdaptFrameworkImport {
  /**
   * Runs the import
   * @param {AdaptFrameworkImportOptions} options
   * @return {Promise&lt;AdaptFrameworkImport>}
   */
  static async run (options) {
    return new AdaptFrameworkImport(options).import()
  }

  /**
   * Returns the schema to be used for a specific content type
   * @param {Object} data The content item
   * @return {String} The schema name
   */
  static typeToSchema (data) {
    switch (data._type) {
      case 'menu':
      case 'page':
        return 'contentobject'
      case 'component':
        return `${data._component}-${data._type}`
      default:
        return data._type
    }
  }

  /**
   * Options to be passed to AdaptFrameworkBuild
   * @typedef {Object} AdaptFrameworkImportOptions
   * @property {String} importPath Path to the import package
   * @property {String} userId Owner of the imported course
   * @property {String} language Language of course files to be imported (if not specified, _defaultLanguage will be used)
   * @property {Array&lt;String>} assetFolders List of non-standard asset directories
   * @property {Array&lt;String>} tags List of tags to apply to the course &amp; assets
   * @property {Boolean} isDryRun Will perform a non-modifying import process and report on the changes if run in standard mode
   * @property {Boolean} importContent Whether course content will be imported (default: true)
   * @property {Boolean} importPlugins Whether content plugins not present on the server will be installed (default: true)
   * @property {Boolean} updatePlugins Whether server content plugins should be updated if newer versions exist in the import course (default: false)
   * @property {Boolean} removeSource Whether import files should be removed after the process has completed (default: true)
   *
   * @constructor
   * @param {AdaptFrameworkImportOptions} options
   */
  constructor ({ importPath, userId, language, assetFolders, tags, isDryRun, importContent = true, importPlugins = true, migrateContent = true, updatePlugins = false, removeSource = true }) {
    const e = App.instance.errors.INVALID_PARAMS
    if (!importPath) throw e.setData({ params: ['importPath'] })
    if (!userId) throw e.setData({ params: ['userId'] })
    /**
     * Reference to the package.json data
     * @type {Object}
     */
    this.pkg = undefined
    /**
     * Path of the import package
     * @type {String}
     */
    this.path = importPath.replaceAll('\\', '/')
    /**
     * Language code for the langauge to import. Used for locating course content.
     * @type {String}
     */
    this.language = language
    /**
     * List of asset folders to check
     * @type {Array&lt;String>}
     */
    this.assetFolders = assetFolders ?? ['assets']
    /**
     * List of asset metadata
     * @type {Array}
     */
    this.assetData = []
    /**
     * List of tags to apply to the course
     * @type {Array&lt;String>}
     */
    this.tags = tags ?? []
    /**
     * Path to the import course folder
     * @type {String}
     */
    this.coursePath = undefined
    /**
     * Path to the import course language folder
     * @type {String}
     */
    this.langPath = undefined
    /**
     * A cache of the import's content JSON file data (note this is not the DB data used by the application)
     * @type {Object}
     */
    this.contentJson = {
      course: {},
      contentObjects: []
    }
    /**
     * Key/value store of the installed content plugins
     * @type {Object}
     */
    this.usedContentPlugins = {}
    /**
     * All plugins installed during the import as a name -> metadata map
     * @type {Object}
     */
    this.newContentPlugins = {}
    /**
     * Key/value store mapping old component keys to component names
     * @type {Object}
     */
    this.componentNameMap = {}
    /**
     * A key/value map of asset file names to new asset ids
     * @type {Object}
     */
    this.assetMap = {}
    /**
     * A key/value map of old ids to new ids
     * @type {Object}
     */
    this.idMap = {}
    /**
     * The _id of the user initiating the import
     * @type {String}
     */
    this.userId = userId
    /**
     * Contains non-fatal infomation messages regarding import status which can be return as response data. Fatal errors are thrown in the usual way.
     * @type {Object}
     */
    this.statusReport = {
      info: [],
      warn: []
    }
    /**
     * Summary information for the import run
     * @type {AdaptFrameworkImportSummary}
     */
    this.summary = undefined
    /**
     * User-defined settings related to what is included with the import
     * @type {Object}
     */
    this.settings = {
      isDryRun,
      importContent,
      importPlugins,
      migrateContent,
      updatePlugins,
      removeSource
    }
    /**
     * Invoked before the import process has started
     */
    this.preImportHook = new Hook()
    /**
     * Invoked once the import process has completed
     */
    this.postImportHook = new Hook()

    /**
     * plugins on import that are of a lower version than the installed version
     * @type {Array}
     */
    this.pluginsToMigrate = ['core']
  }

  /**
   * Imports a course zip to the database
   * @return {Promise} Resolves with the current import instance
   */
  async import () {
    let error
    try {
      const [
        assets,
        content,
        contentplugin,
        courseassets,
        framework,
        jsonschema
      ] = await App.instance.waitForModule('assets', 'content', 'contentplugin', 'courseassets', 'adaptframework', 'jsonschema')
      /**
       * Cached module instance for easy access
       * @type {AssetsModule}
       */
      this.assets = assets
      /**
       * Cached module instance for easy access
       * @type {ContentModule}
       */
      this.content = content
      /**
       * Cached module instance for easy access
       * @type {ContentPluginModule}
       */
      this.contentplugin = contentplugin
      /**
       * Cached module instance for easy access
       * @type {CourseAssetsModule}
       */
      this.courseassets = courseassets
      /**
       * Cached module instance for easy access
       * @type {AdaptFrameworkModule}
       */
      this.framework = framework
      /**
       * Cached module instance for easy access
       * @type {JsonSchemaModule}
       */
      this.jsonschema = jsonschema

      FWUtils.log('debug', 'IMPORT_USER', this.userId)
      FWUtils.log('debug', 'IMPORT_SETTINGS', JSON.stringify(this.settings, null, 2))

      const { isDryRun, importContent, importPlugins, migrateContent } = this.settings
      const tasks = [
        [this.prepare],
        [this.loadAssetData],
        [this.loadPluginData],
        [() => this.preImportHook.invoke(this)],
        [this.importTags, importContent],
        [this.importCourseAssets, importContent],
        [this.importCoursePlugins, isDryRun &amp;&amp; importPlugins],
        [this.importCoursePlugins, !isDryRun &amp;&amp; importContent],
        [this.loadCourseData, isDryRun &amp;&amp; importContent],
        [this.migrateCourseData, !isDryRun &amp;&amp; migrateContent],
        [this.loadCourseData, !isDryRun &amp;&amp; importContent],
        [this.importCourseData, !isDryRun &amp;&amp; importContent],
        [this.generateSummary]
      ]
      for (const [func, test] of tasks) {
        if (test === true || test === undefined) await func.call(this)
      }
      await this.postImportHook.invoke(this)
    } catch (e) {
      error = e
    }
    await this.cleanUp(error)
    if (error) throw error
    return this
  }

  /**
   * Performs preliminary checks to confirm that a course is suitable for import
   * @return {Promise}
   */
  async prepare () {
    if (this.path.endsWith('.zip')) {
      this.path = await unzip(this.path, `${this.path}_unzip`, { removeSource: true })
    }
    try { // if it's a nested zip, move everything up a level
      const files = await fs.readdir(this.path)
      if (files.length === 1) {
        const nestDir = `${this.path}/${files[0]}`
        await fs.stat(`${nestDir}/package.json`)
        const newDir = path.join(`${this.path}_2`)
        await fs.rename(nestDir, newDir)
        await fs.rm(this.path, { recursive: true })
        this.path = newDir
      }
    } catch (e) {
      // nothing to do
    }
    // find and store the course data path
    const courseDirs = await glob(`${this.path}/*/course`)
    if (courseDirs.length > 1) {
      this.framework.log('error', 'MULTIPLE_COURSE_DIRS', courseDirs)
      throw App.instance.errors.FW_IMPORT_INVALID_COURSE
    }
    this.coursePath = courseDirs[0]
    try {
      await this.loadContentFile(`${this.coursePath}/config.json`)
      this.language = this.language ?? this.contentJson.config._defaultLanguage
      this.langPath = `${this.coursePath}/${this.language}`
      await fs.readdir(this.langPath)
    } catch (e) {
      this.framework.log('error', e)
      throw App.instance.errors.FW_IMPORT_INVALID_COURSE
    }
    FWUtils.logDir('unzipPath', this.path)
    FWUtils.logDir('coursePath', this.coursePath)

    try {
      /** @ignore */this.pkg = await FWUtils.readJson(`${this.path}/package.json`)
    } catch (e) {
      throw App.instance.errors.FW_IMPORT_INVALID
    }
    try {
      await fs.rm(`${this.path}/package-lock.json`)
    } catch (e) {}

    if (!semver.satisfies(this.pkg.version, semver.major(this.framework.version).toString())) {
      const data = { installed: this.framework.version, import: this.pkg.version }
      if (!this.settings.migrateContent) {
        throw App.instance.errors.FW_IMPORT_INCOMPAT
          .setData(data)
      }
      this.statusReport.info.push({ code: 'MIGRATE_CONTENT', data })
    }
    await this.convertSchemas()
    FWUtils.log('debug', 'preparation tasks completed successfully')
  }

  /**
   * Converts all properties.schema files to a valid JSON schema format
   * @return {Promise}
   */
  async convertSchemas () {
    return octopus.runRecursive({
      cwd: this.path,
      logger: { log: (...args) => FWUtils.log('debug', ...args) }
    })
  }

  /**
   * Writes the contents of 2-customStyles.less to course.json file. Unfortunately it's necessary to do it this way to ensure it's included in migrations.
   */
  async patchCustomStyle () {
    const [customStylePath] = await glob('**/2-customStyles.less', { cwd: this.path, absolute: true })
    const courseJsonPath = `${this.langPath}/course.json`
    if (!customStylePath) {
      return
    }
    try {
      const customStyle = await fs.readFile(customStylePath, 'utf8')
      const courseJson = await FWUtils.readJson(courseJsonPath)
      await FWUtils.writeJson(courseJsonPath, { customStyle, ...courseJson })
      FWUtils.log('info', 'patched course customStyle')
    } catch (e) {
      FWUtils.log('warn', 'failed to patch course customStyle', e)
    }
  }

  /**
   * Ensures _theme exists on the config
   */
  async patchThemeName () {
    try {
      const configJsonPath = `${this.coursePath}/config.json`
      const configJson = await FWUtils.readJson(configJsonPath)
      if (configJson._theme) return
      configJson._theme = Object.values(this.usedContentPlugins).find(p => p.type === 'theme').name
      await FWUtils.writeJson(configJsonPath, configJson)
      FWUtils.log('info', 'patched config _theme')
    } catch (e) {
      FWUtils.log('warn', 'failed to patch config _theme', e)
    }
  }

  /**
   * Loads and caches all asset data either manually or using the assets.json file
   * @return {Promise}
   */
  async loadAssetData () {
    this.assetData = []
    const metaFiles = await glob(`${this.langPath}/assets.json`, { absolute: true })
    if (metaFiles.length) { // process included asset metadata
      FWUtils.log('debug', 'processing metadata files', metaFiles)
      await Promise.all(metaFiles.map(async f => {
        const metaJson = await FWUtils.readJson(f)
        Object.entries(metaJson).forEach(([filename, metadata]) => this.assetData.push({ filename, ...metadata }))
      }))
    } else { // process the file metadata manually
      const assetFiles = await glob(`${this.langPath}/*/*`, { absolute: true })
      FWUtils.log('debug', 'processing asset files manually', assetFiles.length)
      this.assetData.push(...assetFiles.map(f => Object.assign({}, { title: path.basename(f), filepath: f })))
    }
    const hasGlobalTags = !!this.tags.length
    this.assetData.forEach(a => {
      if (!a.description) a.description = a.title
      if (a.tags?.length &amp;&amp; a.tags[0].title) a.tags = a.tags.map(t => t.title) // convert from old
      if (hasGlobalTags) a.tags = this.tags.concat(a.tags ?? [])
    })
  }

  /**
   * Loads and caches all course plugins
   * @return {Promise}
   */
  async loadPluginData () {
    const usedPluginPaths = await glob(`${this.path}/src/+(components|extensions|menu|theme)/*`, { absolute: true })
    const getPluginType = pluginData => {
      for (const type of ['component', 'extension', 'menu', 'theme']) {
        if (pluginData[type] !== undefined) return type
      }
    }
    await Promise.all(usedPluginPaths.map(async p => {
      const bowerJson = await FWUtils.readJson(`${p}/bower.json`)
      const { name, version, targetAttribute } = bowerJson
      FWUtils.log('debug', 'found plugin', name)
      this.usedContentPlugins[path.basename(p)] = { name, path: p, version, targetAttribute, type: getPluginType(bowerJson) }
    }))
  }

  /**
   * Loads and caches all course content
   * @return {Promise}
   */
  async loadCourseData () {
    const files = await glob('**/*.json', { cwd: this.langPath, absolute: true, ignore: { ignored: p => p.name === 'assets.json' } })
    const mapped = await Promise.all(files.map(f => this.loadContentFile(f)))
    this.statusReport.info.push({ code: 'CONTENT_IMPORTED', data: FWUtils.getImportContentCounts(this.contentJson) })
    FWUtils.log('info', 'loaded course data successfully')
    return mapped
  }

  /**
   * Loads a single content JSON file
   * @return {Promise}
   */
  async loadContentFile (filePath) {
    const contents = await FWUtils.readJson(filePath)
    if (contents._type === 'course') {
      this.contentJson.course = contents
      return
    }
    if (path.basename(filePath) === 'config.json') {
      this.contentJson.config = {
        _id: 'config',
        _type: 'config',
        _enabledPlugins: Object.keys(this.usedContentPlugins),
        ...contents
      }
      return
    }
    if (Array.isArray(contents)) {
      contents.forEach(c => {
        this.contentJson.contentObjects[c._id] = c
        if (!c._type) {
          FWUtils.log('warn', App.instance.errors.FW_IMPORT_INVALID_CONTENT.setData({ item: c }))
          this.statusReport.warn.push({ code: 'INVALID_CONTENT', data: c })
        }
      })
    }
    FWUtils.log('debug', 'LOAD_CONTENT', path.resolve(filePath))
  }

  /**
   * Run grunt task
   * @return {Promise}
   */
  async runGruntMigration (subTask, { outputDir, captureDir, outputFilePath }) {
    const output = await Utils.spawn({
      cmd: 'npx',
      args: ['grunt', `migration:${subTask}`, `--outputdir=${outputDir}`, `--capturedir=${captureDir}`],
      cwd: this.frameworkPath ?? this.framework.path
    })
    if (outputFilePath) await fs.writeFile(outputFilePath, output)
  }

  /**
   * Handle migrate course data, installs adapt-migrations/capture data/adds updated scripts/migrates data
   */
  async migrateCourseData () {
    try {
      await this.patchThemeName()
      await this.patchCustomStyle()

      const migrationId = `${this.userId}-${randomBytes(4).toString('hex')}`

      const opts = {
        outputDir: path.relative(this.framework.path, path.resolve(this.coursePath, '..')),
        captureDir: path.join(`./${migrationId}-migrations`),
        outputFilePath: path.join(this.framework.path, 'migrations', `${migrationId}.txt`)
      }
      FWUtils.log('debug', 'MIGRATION_ID', migrationId)
      FWUtils.logDir('captureDir', opts.captureDir)
      FWUtils.logDir('outputDir', opts.outputDir)

      await this.runGruntMigration('capture', opts)
      await this.runGruntMigration('migrate', opts)

      await fs.rm(path.join(this.framework.path, opts.captureDir), { recursive: true })
    } catch (error) {
      FWUtils.log('error', 'Migration process failed', error)
      throw new Error(`Migration process failed: ${error.message}`)
    }
  }

  /**
   * Imports any specified tags
   * @return {Promise}
   */
  async importTags () {
    const tags = await App.instance.waitForModule('tags')
    const existingTagMap = (await tags.find()).reduce((memo, t) => Object.assign(memo, { [t.title]: t._id.toString() }), {})
    const newTags = new Set()
    const course = this.contentJson.course
    // process course tags
    course?.tags?.forEach(t => {
      if (!existingTagMap[t]) newTags.push(t)
      this.tags.push(t)
    })
    // determine any new asset tags
    this.assetData.forEach(a => {
      a.tags?.forEach(t => !existingTagMap[t] &amp;&amp; newTags.add(t))
    })
    // return early on dry runs
    if (this.settings.isDryRun) {
      this.statusReport.info.push({ code: 'TAGS_IMPORTED', data: { count: newTags.length } })
      return
    }
    // insert new asset tags
    await Promise.all(Array.from(newTags).map(async n => {
      const { _id } = await tags.insert({ title: n })
      existingTagMap[n] = _id.toString()
    }))
    // map tags from titles to new _ids
    this.tags = this.tags.map(t => existingTagMap[t])
    this.assetData.forEach(data => {
      data.tags = data.tags?.map(t => existingTagMap[t])
    })
    if (course.tags) {
      course.tags = course.tags.map(t => existingTagMap[t])
    }
    FWUtils.log('debug', 'imported tags successfully')
  }

  /**
   * Imports course asset files
   * @return {Promise}
   */
  async importCourseAssets () {
    let imagesImported = this.settings.isDryRun ? this.assetData.length : 0
    await Promise.all(this.assetData.map(async data => {
      const filepath = data.filepath ?? (await glob(`${this.langPath}/*/${data.filename}`, { absolute: true }))[0]
      // remove unused filepath to avoid possible issues
      delete data.filepath
      if (this.settings.isDryRun) {
        return
      }
      try {
        const asset = await this.assets.insert({
          ...data,
          createdBy: this.userId,
          file: {
            filepath,
            originalFilename: filepath
          },
          tags: data.tags
        })
        // store the asset _id so we can map it to the old path later
        const resolved = path.relative(`${this.coursePath}/..`, filepath)
        this.assetMap[resolved] = asset._id.toString()
      } catch (e) {
        this.statusReport.warn.push({ code: 'ASSET_IMPORT_FAILED', data: { filepath } })
      }
      imagesImported++
    }))
    FWUtils.log('debug', 'imported course assets successfully')
    this.statusReport.info.push({ code: 'ASSETS_IMPORTED_SUCCESSFULLY', data: { count: imagesImported } })
  }

  /**
   * Imports course content plugins
   * @return {Promise}
   */
  async importCoursePlugins () {
    this.installedPlugins = (await this.contentplugin.find({})).reduce((m, p) => Object.assign(m, { [p.name]: p }), {})
    const pluginsToInstall = []
    const pluginsToUpdate = []

    if (!this.settings.updatePlugins) {
      this.statusReport.warn.push({ code: 'MANAGED_PLUGIN_UPDATE_DISABLED' })
    }
    Object.keys(this.usedContentPlugins).forEach(p => {
      const installedP = this.installedPlugins[p]
      let { version: importVersion } = this.usedContentPlugins[p]
      if (!semver.valid(importVersion)) {
        if (!installedP) {
          throw App.instance.errors.FW_INVALID_VERSION.setData({ name: p, version: importVersion })
        }
        this.statusReport.warn.push({ code: 'INVALID_PLUGIN_VERSION', data: { name: p, importVersion } })
        importVersion = '0.0.0' // set to a valid version to allow the other logic to run
      }
      if (!installedP) {
        return pluginsToInstall.push(p)
      }
      const { version: installedVersion, isLocalInstall } = installedP
      if (semver.lt(importVersion, installedVersion)) {
        this.statusReport.info.push({ code: 'PLUGIN_INSTALL_MIGRATING', data: { name: p, installedVersion, importVersion } })
        FWUtils.log('debug', `migrating '${p}@${importVersion}' during import, installed version is newer (${installedVersion})`)
        this.pluginsToMigrate.push(p)
        return
      }
      if (!this.settings.updatePlugins) {
        return
      }
      if (semver.eq(importVersion, installedVersion)) {
        this.statusReport.info.push({ code: 'PLUGIN_INSTALL_NOT_NEWER', data: { name: p, installedVersion, importVersion } })
        FWUtils.log('debug', `not updating '${p}@${importVersion}' during import, installed version is equal to (${installedVersion})`)
        return
      }
      if (!isLocalInstall) {
        this.statusReport.warn.push({ code: 'MANAGED_PLUGIN_INSTALL_SKIPPED', data: { name: p, installedVersion, importVersion } })
        FWUtils.log('debug', `cannot update '${p}' during import, plugin managed via UI`)
      }
      pluginsToUpdate.push(p)
    })
    if (pluginsToInstall.length) {
      if (!this.settings.importPlugins) {
        if (this.settings.isDryRun) return this.statusReport.error.push({ code: 'MISSING_PLUGINS', data: pluginsToInstall })
        throw App.instance.errors.FW_IMPORT_MISSING_PLUGINS
          .setData({ plugins: pluginsToInstall.join(', ') })
      }
      const errors = []
      await Promise.all([...pluginsToInstall, ...pluginsToUpdate].map(async p => {
        try {
          // try and infer a targetAttribute if there isn't one
          const pluginBowerPath = path.join(this.usedContentPlugins[p].path, 'bower.json')
          const bowerJson = await FWUtils.readJson(pluginBowerPath)
          if (!bowerJson.targetAttribute) {
            bowerJson.targetAttribute = `_${bowerJson.component || bowerJson.extension || bowerJson.menu || bowerJson.theme}`
            await FWUtils.writeJson(pluginBowerPath, bowerJson)
          }
          if (!this.settings.isDryRun) {
            const [pluginData] = await this.contentplugin.installPlugins([[p, this.usedContentPlugins[p].path]], { strict: true })
            this.newContentPlugins[p] = pluginData
          }
          this.statusReport.info.push({ code: 'INSTALL_PLUGIN', data: { name: p, version: bowerJson.version } })
        } catch (e) {
          if (e.code !== 'EEXIST') {
            FWUtils.log('error', 'PLUGIN_IMPORT_FAILED', p, e)
            errors.push({ plugin: p, error: e.data.errors[0] })
          } else {
            errors.push(e)
          }
        }
      }))
      if (errors.length) {
        throw App.instance.errors.FW_IMPORT_PLUGINS_FAILED
          .setData({ errors: errors.map(e => App.instance.lang.translate(undefined, e)).join(', ') })
      }
    }
    this.componentNameMap = Object.values({ ...this.installedPlugins, ...this.newContentPlugins }).reduce((m, v) => {
      return { ...m, [v.targetAttribute.slice(1)]: v.name }
    }, {})
    FWUtils.log('debug', 'imported course plugins successfully')
  }

  /**
   * Imports all course content data
   * @return {Promise}
   */
  async importCourseData () {
    /**
     * Note: the execution order is important here
     * - config requires course to exist
     * - Defaults cannot be applied until the config exists
     * - Everything else requires course + config to exist
     */
    const course = await this.importContentObject({ ...this.contentJson.course, tags: this.tags })
    /*  config  */ await this.importContentObject(this.contentJson.config)
    // we need to run an update with the same data to make sure all extension schema settings are applied
    await this.importContentObject({ ...this.contentJson.course, _id: course._id }, { isUpdate: true })

    const { sorted, hierarchy } = await this.getSortedData()
    const errors = []
    for (const ids of sorted) {
      for (const _id of ids) {
        try {
          const itemJson = this.contentJson.contentObjects[_id]
          await this.importContentObject({
            _sortOrder: hierarchy[itemJson._parentId].indexOf(_id) + 1,
            ...itemJson // note that JSON sort order will override the deduced one
          })
        } catch (e) {
          errors.push(e?.data?.schemaName
            ? `${e.data.schemaName} ${_id} ${e.data.errors}`
            : App.instance.lang.translate(undefined, e)
          )
        }
      }
    }
    if (errors.length) throw App.instance.errors.FW_IMPORT_CONTENT_FAILED.setData({ errors: errors.join('; ') })
    FWUtils.log('debug', 'imported course data successfully')
  }

  /**
   * Sorts the import content objects into a 2D array separating each 'level' of siblings to allow processing without the need to work out whether the parent object exists.
   * @returns {Array&lt;Array&lt;String>>} The sorted list
   */
  getSortedData () {
    const sorted = [[this.contentJson.course._id]]
    const hierarchy = Object.values(this.contentJson.contentObjects).reduce((h, c) => {
      return Object.assign(h, {
        [c._parentId]: [...(h[c._parentId] ?? []), c._id]
      })
    }, {})
    const toSort = Object.keys(hierarchy)
    while (toSort.length) {
      const newLevel = []
      sorted[sorted.length - 1].forEach(_id => {
        newLevel.push(...(hierarchy[_id] ?? []))
        toSort.splice(toSort.indexOf(_id), 1)
      })
      if (!newLevel.length) {
        throw App.instance.errors.FW_IMPORT_UNEXPECTED_STRUCTURE // level has no children, so something's gone wrong
      }
      sorted.push(newLevel)
    }
    return { sorted: sorted.slice(1), hierarchy } // remove course from sorted
  }

  /**
   * Imports a single content object
   * @return {Object} The data to be imported
   * @return {Promise} Resolves with the created document
   */
  async importContentObject (data, options = {}) {
    let insertData = await this.transformData({
      ...data,
      _id: undefined,
      _courseId: this.idMap.course,
      createdBy: this.userId
    })
    const schemaName = AdaptFrameworkImport.typeToSchema(data)
    const schema = await this.content.getSchema(schemaName, insertData)
    try {
      this.extractAssets(schema.built.properties, insertData)
    } catch (e) {
      FWUtils.log('error', `failed to extract asset data for attribute '${e.attribute}' of schema '${schemaName}', ${e}`)
    }
    insertData = await schema.sanitise(insertData)
    let doc
    const opts = { schemaName, validate: true, useCache: false }
    if (options.isUpdate) {
      doc = await this.content.update({ _id: data._id }, insertData, opts)
    } else {
      doc = await this.content.insert(insertData, opts)
      this.idMap[data._id] = doc._id.toString()
      if (doc._type === 'course') this.idMap.course = this.idMap[data._id]
    }
    return doc
  }

  /**
   * Performs custom data transforms prior to import
   * @param {Object} data Data to transform
   * @return {Promise} Resolves with the transformed data
   */
  async transformData (data) {
    const migrations = [...ContentMigrations, ...this.framework.contentMigrations]
    for (const Migration of migrations) await Migration(data, this)
    return data
  }

  /**
   * Infers the presence of any assets in incoming JSON data
   * @param {Object} schema Schema for the passed data
   * @param {Object} data Data to check
   */
  extractAssets (schema, data) {
    if (!schema) {
      return
    }
    Object.entries(schema).forEach(([key, val]) => {
      if (data[key] === undefined) {
        return
      }
      if (val.properties) {
        this.extractAssets(val.properties, data[key])
      } else if (val?.items?.properties) {
        data[key].forEach(d => this.extractAssets(val.items.properties, d))
      } else if (val?._backboneForms?.type === 'Asset' || val?._backboneForms === 'Asset') {
        data[key] !== ''
          ? data[key] = this.assetMap[data[key]] ?? data[key]
          : delete data[key]
      }
    })
  }

  /**
   * Performs necessary clean-up tasks
   * @param {Error|Boolean} error If param is truthy, extra error-related clean-up tasks are performed
   * @return {Promise}
   */
  async generateSummary () {
    this.summary = await FWUtils.getImportSummary(this)
  }

  /**
   * Performs necessary clean-up tasks
   * @param {Error|Boolean} error If param is truthy, extra error-related clean-up tasks are performed
   * @return {Promise}
   */
  async cleanUp (error) {
    if (!this.settings.removeSource) {
      return
    }
    try {
      const tasks = [
        fs.rm(this.path, { recursive: true })
      ]
      if (error) {
        tasks.push(
          Promise.all(Object.values(this.newContentPlugins).map(p => this.contentplugin.uninstallPlugin(p._id))),
          Promise.all(Object.values(this.assetMap).map(a => this.assets.delete({ _id: a })))
        )
        let _courseId
        try {
          const { ObjectId } = await App.instance.waitForModule('mongodb')
          _courseId = ObjectId.parse(this.idMap[this.contentJson.course._id])
        } catch (e) {}
        if (_courseId) {
          tasks.push(
            this.content.deleteMany({ _courseId }),
            this.courseassets.deleteMany({ courseId: _courseId })
          )
        }
      }
      await Promise.allSettled(tasks)
    } catch (e) {} // ignore any thrown errors
  }
}

export default AdaptFrameworkImport
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Thu Jan 22 2026 15:56:46 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


    <link type="text/css" rel="stylesheet" href="styles/adapt.css">
    
    <script src="scripts/adapt.js"></script>
    
</body>
</html>
